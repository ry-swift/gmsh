# 常用选项参考

Gmsh通过选项系统控制各模块的行为。

## 选项操作API

### 设置和获取选项

```python
import gmsh

gmsh.initialize()

# 数值选项
gmsh.option.setNumber("Mesh.MeshSizeMax", 0.5)
value = gmsh.option.getNumber("Mesh.MeshSizeMax")

# 字符串选项
gmsh.option.setString("General.GraphicsFont", "Helvetica")
font = gmsh.option.getString("General.GraphicsFont")

# 颜色选项 (RGBA)
gmsh.option.setColor("Mesh.SurfaceFaces", 255, 0, 0, 255)
r, g, b, a = gmsh.option.getColor("Mesh.SurfaceFaces")

gmsh.finalize()
```

### 选项命名规则

```
Category.OptionName

Category:
- General    : 通用设置
- Geometry   : 几何选项
- Mesh       : 网格选项
- Solver     : 求解器选项
- PostPro    : 后处理选项
- View[N]    : 第N个视图的选项
```

## General（通用选项）

### 基本设置

```python
# 详细输出级别 (0=静默, 1=错误, 2=警告, 3=信息, 4=进度, 5=调试, 99=全部)
gmsh.option.setNumber("General.Verbosity", 5)

# 终端输出
gmsh.option.setNumber("General.Terminal", 1)  # 输出到终端

# 线程数
gmsh.option.setNumber("General.NumThreads", 4)

# 随机种子
gmsh.option.setNumber("General.RandomSeed", 1)

# 专家模式（显示高级选项）
gmsh.option.setNumber("General.ExpertMode", 1)
```

### 文件和路径

```python
# 默认文件名
gmsh.option.setString("General.DefaultFileName", "untitled.geo")

# 临时文件目录
gmsh.option.setString("General.TmpDirectory", "/tmp")

# 错误文件名
gmsh.option.setString("General.ErrorFileName", "gmsh-errors")
```

### 显示设置

```python
# 图形字体
gmsh.option.setString("General.GraphicsFont", "Helvetica")
gmsh.option.setNumber("General.GraphicsFontSize", 12)

# 背景颜色
gmsh.option.setColor("General.Background", 255, 255, 255, 255)  # 白色

# 前景颜色
gmsh.option.setColor("General.Foreground", 0, 0, 0, 255)  # 黑色

# 坐标轴
gmsh.option.setNumber("General.Axes", 1)  # 0=关, 1=简单, 2=完整

# 正交/透视投影
gmsh.option.setNumber("General.Orthographic", 1)  # 1=正交, 0=透视
```

## Geometry（几何选项）

### 容差设置

```python
# 几何容差
gmsh.option.setNumber("Geometry.Tolerance", 1e-8)

# 曲线采样点数
gmsh.option.setNumber("Geometry.NumSubEdges", 40)

# 曲面采样点数
gmsh.option.setNumber("Geometry.Points", 0)  # 0=关闭显示
```

### OpenCASCADE设置

```python
# OCC单位
# M=1, MM=1000, IN=39.37, FT=3.28
gmsh.option.setString("Geometry.OCCTargetUnit", "M")

# OCC缝合容差
gmsh.option.setNumber("Geometry.OCCSewFaces", 1)
gmsh.option.setNumber("Geometry.OCCImportLabels", 1)

# OCC愈合选项
gmsh.option.setNumber("Geometry.OCCFixDegenerated", 1)
gmsh.option.setNumber("Geometry.OCCFixSmallEdges", 1)
gmsh.option.setNumber("Geometry.OCCFixSmallFaces", 1)

# 导入时的缩放
gmsh.option.setNumber("Geometry.OCCScaling", 1.0)
```

### 显示选项

```python
# 显示点
gmsh.option.setNumber("Geometry.Points", 1)

# 显示曲线
gmsh.option.setNumber("Geometry.Curves", 1)

# 显示曲面
gmsh.option.setNumber("Geometry.Surfaces", 1)

# 显示体积
gmsh.option.setNumber("Geometry.Volumes", 0)

# 点大小
gmsh.option.setNumber("Geometry.PointSize", 4)

# 曲线宽度
gmsh.option.setNumber("Geometry.CurveWidth", 2)
```

## Mesh（网格选项）

### 尺寸控制

```python
# 全局最小/最大尺寸
gmsh.option.setNumber("Mesh.MeshSizeMin", 0.01)
gmsh.option.setNumber("Mesh.MeshSizeMax", 1.0)

# 尺寸因子（全局缩放）
gmsh.option.setNumber("Mesh.MeshSizeFactor", 1.0)

# 从边界延伸尺寸
gmsh.option.setNumber("Mesh.MeshSizeExtendFromBoundary", 1)  # 1=启用

# 从点获取尺寸
gmsh.option.setNumber("Mesh.MeshSizeFromPoints", 1)

# 从曲率获取尺寸
gmsh.option.setNumber("Mesh.MeshSizeFromCurvature", 0)
gmsh.option.setNumber("Mesh.MinimumElementsPerTwoPi", 6)  # 曲率采样

# 从参数坐标获取尺寸
gmsh.option.setNumber("Mesh.MeshSizeFromParametricPoints", 0)
```

### 网格算法

```python
# 2D网格算法
# 1: MeshAdapt
# 2: Automatic
# 3: Initial mesh only
# 5: Delaunay
# 6: Frontal-Delaunay (默认)
# 7: BAMG
# 8: Frontal-Delaunay for Quads
# 9: Packing of Parallelograms
# 11: Quasi-structured Quad
gmsh.option.setNumber("Mesh.Algorithm", 6)

# 3D网格算法
# 1: Delaunay (默认)
# 3: Initial mesh only
# 4: Frontal
# 7: MMG3D
# 9: R-tree
# 10: HXT (并行)
gmsh.option.setNumber("Mesh.Algorithm3D", 1)

# 细分算法
# 0: None
# 1: All Quads
# 2: All Hexas
# 3: Barycentric
gmsh.option.setNumber("Mesh.SubdivisionAlgorithm", 0)
```

### 元素设置

```python
# 元素阶数 (1=线性, 2=二次, ...)
gmsh.option.setNumber("Mesh.ElementOrder", 1)

# 高阶元素设置
gmsh.option.setNumber("Mesh.SecondOrderLinear", 0)  # 0=使用几何, 1=线性
gmsh.option.setNumber("Mesh.SecondOrderIncomplete", 0)  # 不完全元素

# 高阶优化
gmsh.option.setNumber("Mesh.HighOrderOptimize", 0)  # 0=关, 1=优化

# 强制2D四边形
gmsh.option.setNumber("Mesh.RecombineAll", 0)  # 1=全部重组

# 3D重组
gmsh.option.setNumber("Mesh.Recombine3DAll", 0)
gmsh.option.setNumber("Mesh.Recombine3DLevel", 0)
gmsh.option.setNumber("Mesh.Recombine3DConformity", 0)
```

### 网格优化

```python
# 优化网格
gmsh.option.setNumber("Mesh.Optimize", 1)

# Netgen优化
gmsh.option.setNumber("Mesh.OptimizeNetgen", 0)

# 优化阈值
gmsh.option.setNumber("Mesh.OptimizeThreshold", 0.3)

# 平滑迭代次数
gmsh.option.setNumber("Mesh.Smoothing", 1)

# Lloyd平滑
gmsh.option.setNumber("Mesh.Lloyd", 0)  # 迭代次数
```

### 网格格式

```python
# MSH文件版本
gmsh.option.setNumber("Mesh.MshFileVersion", 4.1)  # 2.2, 4.0, 4.1

# 二进制格式
gmsh.option.setNumber("Mesh.Binary", 0)  # 1=二进制

# 保存所有元素
gmsh.option.setNumber("Mesh.SaveAll", 0)  # 1=保存所有

# 保存分组
gmsh.option.setNumber("Mesh.SaveGroupsOfNodes", 0)
gmsh.option.setNumber("Mesh.SaveGroupsOfElements", 1)

# VTK格式设置
gmsh.option.setNumber("Mesh.VtkWriteAll", 0)
```

### 分区设置

```python
# 分区算法
# 1: METIS (默认)
# 2: Simple
gmsh.option.setNumber("Mesh.PartitionAlgorithm", 1)

# 创建分区拓扑
gmsh.option.setNumber("Mesh.PartitionCreateTopology", 1)

# 创建物理组
gmsh.option.setNumber("Mesh.PartitionCreatePhysicals", 1)

# 创建Ghost单元
gmsh.option.setNumber("Mesh.PartitionCreateGhostCells", 0)

# METIS选项
gmsh.option.setNumber("Mesh.MetisAlgorithm", 1)  # 1=kway, 2=recursive
gmsh.option.setNumber("Mesh.MetisEdgeMatching", 0)
gmsh.option.setNumber("Mesh.MetisRefinementIterations", 10)
```

### 显示选项

```python
# 显示节点
gmsh.option.setNumber("Mesh.Points", 0)

# 显示曲线（1D元素）
gmsh.option.setNumber("Mesh.Lines", 0)

# 显示曲面（2D元素）
gmsh.option.setNumber("Mesh.SurfaceEdges", 1)  # 边
gmsh.option.setNumber("Mesh.SurfaceFaces", 0)  # 面

# 显示体积（3D元素）
gmsh.option.setNumber("Mesh.VolumeEdges", 0)
gmsh.option.setNumber("Mesh.VolumeFaces", 0)

# 节点/元素标签
gmsh.option.setNumber("Mesh.PointNumbers", 0)
gmsh.option.setNumber("Mesh.LineNumbers", 0)
gmsh.option.setNumber("Mesh.SurfaceNumbers", 0)
gmsh.option.setNumber("Mesh.VolumeNumbers", 0)

# 颜色
gmsh.option.setColor("Mesh.Points", 0, 0, 0, 255)
gmsh.option.setColor("Mesh.Lines", 0, 0, 0, 255)
gmsh.option.setColor("Mesh.SurfaceFaces", 210, 210, 210, 255)

# 颜色方案
# 0: 按几何实体
# 1: 按物理实体
# 2: 按分区
gmsh.option.setNumber("Mesh.ColorCarousel", 0)
```

## PostPro（后处理选项）

### 通用设置

```python
# 动画延迟（毫秒）
gmsh.option.setNumber("PostProcessing.AnimationDelay", 100)

# 动画循环
gmsh.option.setNumber("PostProcessing.AnimationCycle", 0)  # 0=关, 1=开

# 保存网格
gmsh.option.setNumber("PostProcessing.SaveMesh", 0)

# 二进制格式
gmsh.option.setNumber("PostProcessing.Binary", 0)
```

## View（视图选项）

视图选项使用 `View[N].OptionName` 格式，N为视图索引。

### 通用显示

```python
# 获取视图索引
view_tags = gmsh.view.getTags()
view_index = view_tags[0] if view_tags else 0

# 视图名称
gmsh.option.setString(f"View[{view_index}].Name", "Temperature")

# 可见性
gmsh.option.setNumber(f"View[{view_index}].Visible", 1)

# 显示类型
# 1: 点
# 2: 线
# 3: 三角形/四面体
# 4: 四边形/六面体
gmsh.option.setNumber(f"View[{view_index}].ShowElement", 0)

# 绘制类型
# 1: 原始
# 2: 纹理
# 3: 字符
gmsh.option.setNumber(f"View[{view_index}].Type", 2)
```

### 数值范围

```python
# 范围类型
# 1: 默认（最小到最大）
# 2: 自定义
# 3: 每步
gmsh.option.setNumber(f"View[{view_index}].RangeType", 2)

# 自定义范围
gmsh.option.setNumber(f"View[{view_index}].CustomMin", 0)
gmsh.option.setNumber(f"View[{view_index}].CustomMax", 100)

# 饱和值
gmsh.option.setNumber(f"View[{view_index}].SaturateValues", 1)
```

### 颜色映射

```python
# 颜色表类型
# 0: 默认
# 1: 可视化（彩虹）
# 2: 反向
# 等等
gmsh.option.setNumber(f"View[{view_index}].ColormapNumber", 1)

# 颜色数量
gmsh.option.setNumber(f"View[{view_index}].NbIso", 20)

# 透明度
gmsh.option.setNumber(f"View[{view_index}].ColormapAlpha", 1.0)

# 反转颜色
gmsh.option.setNumber(f"View[{view_index}].ColormapInvert", 0)
```

### 等值线/等值面

```python
# 显示等值线
gmsh.option.setNumber(f"View[{view_index}].ShowScale", 1)

# 等值线数量
gmsh.option.setNumber(f"View[{view_index}].NbIso", 10)

# 等值线类型
# 1: 等值线
# 2: 连续
# 3: 离散
# 4: 数值
gmsh.option.setNumber(f"View[{view_index}].IntervalsType", 2)
```

### 向量显示

```python
# 向量类型
# 1: 线段
# 2: 箭头
# 3: 金字塔
# 4: 3D箭头
# 5: 位移
# 6: 切片
gmsh.option.setNumber(f"View[{view_index}].VectorType", 4)

# 向量缩放
gmsh.option.setNumber(f"View[{view_index}].ArrowSizeMax", 60)
gmsh.option.setNumber(f"View[{view_index}].ArrowSizeMin", 0)

# 向量位置
# 1: 重心
# 2: 节点
gmsh.option.setNumber(f"View[{view_index}].GlyphLocation", 1)
```

### 光照

```python
# 启用光照
gmsh.option.setNumber(f"View[{view_index}].Light", 1)

# 光源位置
gmsh.option.setNumber("General.Light0", 1)  # 启用光源0
gmsh.option.setNumber("General.Light0X", 0.65)
gmsh.option.setNumber("General.Light0Y", 0.65)
gmsh.option.setNumber("General.Light0Z", 1.0)
```

## 完整示例：常用选项配置

```python
#!/usr/bin/env python3
"""
Gmsh常用选项配置示例
"""
import gmsh

def setup_general_options():
    """通用选项配置"""
    # 输出设置
    gmsh.option.setNumber("General.Verbosity", 5)
    gmsh.option.setNumber("General.Terminal", 1)
    gmsh.option.setNumber("General.NumThreads", 4)

    # 显示设置
    gmsh.option.setColor("General.Background", 255, 255, 255, 255)
    gmsh.option.setColor("General.Foreground", 0, 0, 0, 255)
    gmsh.option.setNumber("General.Orthographic", 1)
    gmsh.option.setNumber("General.Axes", 1)

def setup_geometry_options():
    """几何选项配置"""
    # 容差
    gmsh.option.setNumber("Geometry.Tolerance", 1e-8)

    # OCC设置
    gmsh.option.setNumber("Geometry.OCCSewFaces", 1)
    gmsh.option.setNumber("Geometry.OCCFixDegenerated", 1)
    gmsh.option.setNumber("Geometry.OCCFixSmallEdges", 1)

    # 显示
    gmsh.option.setNumber("Geometry.Points", 1)
    gmsh.option.setNumber("Geometry.Curves", 1)
    gmsh.option.setNumber("Geometry.Surfaces", 0)
    gmsh.option.setNumber("Geometry.PointSize", 4)

def setup_mesh_options(size_min=0.01, size_max=1.0, algorithm_2d=6, algorithm_3d=1):
    """网格选项配置"""
    # 尺寸
    gmsh.option.setNumber("Mesh.MeshSizeMin", size_min)
    gmsh.option.setNumber("Mesh.MeshSizeMax", size_max)
    gmsh.option.setNumber("Mesh.MeshSizeFactor", 1.0)

    # 算法
    gmsh.option.setNumber("Mesh.Algorithm", algorithm_2d)
    gmsh.option.setNumber("Mesh.Algorithm3D", algorithm_3d)

    # 元素
    gmsh.option.setNumber("Mesh.ElementOrder", 1)

    # 优化
    gmsh.option.setNumber("Mesh.Optimize", 1)
    gmsh.option.setNumber("Mesh.OptimizeNetgen", 1)
    gmsh.option.setNumber("Mesh.Smoothing", 1)

    # 显示
    gmsh.option.setNumber("Mesh.Points", 0)
    gmsh.option.setNumber("Mesh.SurfaceEdges", 1)
    gmsh.option.setNumber("Mesh.SurfaceFaces", 0)
    gmsh.option.setNumber("Mesh.VolumeEdges", 0)

def setup_view_options(view_index=0):
    """视图选项配置"""
    prefix = f"View[{view_index}]"

    # 基本显示
    gmsh.option.setNumber(f"{prefix}.Visible", 1)
    gmsh.option.setNumber(f"{prefix}.ShowScale", 1)

    # 范围
    gmsh.option.setNumber(f"{prefix}.RangeType", 1)  # 自动

    # 颜色
    gmsh.option.setNumber(f"{prefix}.ColormapNumber", 1)
    gmsh.option.setNumber(f"{prefix}.NbIso", 20)

    # 等值线
    gmsh.option.setNumber(f"{prefix}.IntervalsType", 2)  # 连续

    # 光照
    gmsh.option.setNumber(f"{prefix}.Light", 1)

def setup_export_options():
    """导出选项配置"""
    # MSH格式
    gmsh.option.setNumber("Mesh.MshFileVersion", 4.1)
    gmsh.option.setNumber("Mesh.Binary", 0)
    gmsh.option.setNumber("Mesh.SaveAll", 0)

def main():
    gmsh.initialize()
    gmsh.model.add("options_example")

    # 配置选项
    setup_general_options()
    setup_geometry_options()
    setup_mesh_options(size_min=0.05, size_max=0.3)
    setup_export_options()

    # 创建几何
    gmsh.model.occ.addBox(0, 0, 0, 1, 1, 1)
    gmsh.model.occ.synchronize()

    # 生成网格
    gmsh.model.mesh.generate(3)

    # 保存
    gmsh.write("options_example.msh")

    gmsh.finalize()

if __name__ == "__main__":
    main()
```

## 选项汇总表

### General选项

| 选项 | 类型 | 默认值 | 描述 |
|------|------|--------|------|
| Verbosity | Number | 5 | 详细级别 |
| Terminal | Number | 0 | 终端输出 |
| NumThreads | Number | 1 | 线程数 |
| ExpertMode | Number | 0 | 专家模式 |
| Axes | Number | 1 | 坐标轴 |
| Orthographic | Number | 1 | 正交投影 |

### Geometry选项

| 选项 | 类型 | 默认值 | 描述 |
|------|------|--------|------|
| Tolerance | Number | 1e-8 | 几何容差 |
| OCCTargetUnit | String | M | OCC单位 |
| OCCSewFaces | Number | 1 | 缝合面 |
| Points | Number | 1 | 显示点 |
| Curves | Number | 1 | 显示曲线 |

### Mesh选项

| 选项 | 类型 | 默认值 | 描述 |
|------|------|--------|------|
| MeshSizeMin | Number | 0 | 最小尺寸 |
| MeshSizeMax | Number | 1e22 | 最大尺寸 |
| MeshSizeFactor | Number | 1 | 尺寸因子 |
| Algorithm | Number | 6 | 2D算法 |
| Algorithm3D | Number | 1 | 3D算法 |
| ElementOrder | Number | 1 | 元素阶数 |
| Optimize | Number | 1 | 优化 |
| OptimizeNetgen | Number | 0 | Netgen优化 |
| MshFileVersion | Number | 4.1 | MSH版本 |

### View选项

| 选项 | 类型 | 默认值 | 描述 |
|------|------|--------|------|
| Visible | Number | 1 | 可见性 |
| RangeType | Number | 1 | 范围类型 |
| ColormapNumber | Number | 0 | 颜色表 |
| NbIso | Number | 10 | 等值线数 |
| IntervalsType | Number | 2 | 间隔类型 |
| VectorType | Number | 4 | 向量类型 |
| Light | Number | 1 | 光照 |

## 下一步

- [04-GUI交互](./04-GUI交互.md) - 学习Gmsh GUI编程接口
