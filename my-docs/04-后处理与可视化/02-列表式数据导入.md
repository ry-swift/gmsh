# 列表式数据导入

列表式数据（List-based data）直接指定几何坐标和对应的值，不依赖于现有网格。

## 数据格式概述

```
列表式数据结构：
┌──────────────────────────────────────────┐
│ 类型码 + 坐标数据 + 数值数据             │
│ SP(x,y,z){v}     点标量                  │
│ VP(x,y,z){vx,vy,vz}  点向量              │
│ ST(x1,y1,z1,...){v1,v2,v3}  三角形标量   │
└──────────────────────────────────────────┘
```

## 元素类型代码

### 点类型

| 代码 | 名称 | 格式 |
|-----|------|------|
| SP | Scalar Point | (x,y,z){v} |
| VP | Vector Point | (x,y,z){vx,vy,vz} |
| TP | Tensor Point | (x,y,z){t11,t12,...,t33} |

### 线类型

| 代码 | 名称 | 格式 |
|-----|------|------|
| SL | Scalar Line | (x1,y1,z1,x2,y2,z2){v1,v2} |
| VL | Vector Line | (x1,...,z2){vx1,vy1,vz1,vx2,vy2,vz2} |
| TL | Tensor Line | 9个分量×2个节点 |

### 三角形类型

| 代码 | 名称 | 格式 |
|-----|------|------|
| ST | Scalar Triangle | 3个坐标点,3个值 |
| VT | Vector Triangle | 3个坐标点,9个值(3×3) |
| TT | Tensor Triangle | 3个坐标点,27个值(9×3) |

### 四边形类型

| 代码 | 名称 | 格式 |
|-----|------|------|
| SQ | Scalar Quadrangle | 4个坐标点,4个值 |
| VQ | Vector Quadrangle | 4个坐标点,12个值 |
| TQ | Tensor Quadrangle | 4个坐标点,36个值 |

### 四面体类型

| 代码 | 名称 | 格式 |
|-----|------|------|
| SS | Scalar Tetrahedron | 4个坐标点,4个值 |
| VS | Vector Tetrahedron | 4个坐标点,12个值 |
| TS | Tensor Tetrahedron | 4个坐标点,36个值 |

### 六面体类型

| 代码 | 名称 | 格式 |
|-----|------|------|
| SH | Scalar Hexahedron | 8个坐标点,8个值 |
| VH | Vector Hexahedron | 8个坐标点,24个值 |
| TH | Tensor Hexahedron | 8个坐标点,72个值 |

## 添加点数据

### 标量点

```python
#!/usr/bin/env python3
"""
创建标量点数据
"""
import gmsh
import numpy as np

gmsh.initialize()

# 创建View
view = gmsh.view.add("ScalarPoints")

# 准备数据
# 格式: [x1, y1, z1, v1, x2, y2, z2, v2, ...]
data = []

# 创建网格点
n = 20
for i in range(n):
    for j in range(n):
        x = i / (n - 1)
        y = j / (n - 1)
        z = 0

        # 计算标量值
        value = np.sin(np.pi * x) * np.cos(np.pi * y)

        data.extend([x, y, z, value])

# 添加数据
# addListData(tag, dataType, numEle, data)
num_points = len(data) // 4
gmsh.view.addListData(view, "SP", num_points, data)

# 保存
gmsh.view.write(view, "scalar_points.pos")

gmsh.finalize()
```

### 向量点

```python
#!/usr/bin/env python3
"""
创建向量点数据（如速度场）
"""
import gmsh
import numpy as np

gmsh.initialize()

view = gmsh.view.add("VelocityField")

# 准备数据
# 格式: [x1, y1, z1, vx1, vy1, vz1, ...]
data = []

n = 15
for i in range(n):
    for j in range(n):
        x = i / (n - 1) * 2 - 1  # [-1, 1]
        y = j / (n - 1) * 2 - 1
        z = 0

        # 旋转向量场
        vx = -y
        vy = x
        vz = 0

        data.extend([x, y, z, vx, vy, vz])

num_points = len(data) // 6
gmsh.view.addListData(view, "VP", num_points, data)

# 设置向量显示选项
gmsh.option.setNumber("View[0].VectorType", 4)  # 圆锥
gmsh.option.setNumber("View[0].ArrowSizeMax", 30)

gmsh.view.write(view, "velocity_points.pos")
gmsh.finalize()
```

### 张量点

```python
#!/usr/bin/env python3
"""
创建张量点数据（如应力张量）
"""
import gmsh
import numpy as np

gmsh.initialize()

view = gmsh.view.add("StressTensor")

# 准备数据
# 格式: [x, y, z, t11, t12, t13, t21, t22, t23, t31, t32, t33]
data = []

n = 10
for i in range(n):
    for j in range(n):
        x = i / (n - 1)
        y = j / (n - 1)
        z = 0

        # 简单应力张量
        sigma_xx = 100 * x
        sigma_yy = 50 * y
        sigma_xy = 20 * x * y
        sigma_zz = 0

        # 对称张量
        tensor = [
            sigma_xx, sigma_xy, 0,
            sigma_xy, sigma_yy, 0,
            0, 0, sigma_zz
        ]

        data.extend([x, y, z] + tensor)

num_points = len(data) // 12
gmsh.view.addListData(view, "TP", num_points, data)

gmsh.view.write(view, "stress_tensor.pos")
gmsh.finalize()
```

## 添加单元数据

### 三角形数据

```python
#!/usr/bin/env python3
"""
创建三角形标量数据
"""
import gmsh
import numpy as np

gmsh.initialize()

view = gmsh.view.add("TriangleScalar")

# 准备数据
# 格式: [x1,y1,z1, x2,y2,z2, x3,y3,z3, v1,v2,v3]
data = []

# 创建简单三角形网格
n = 5
for i in range(n):
    for j in range(n):
        x0, y0 = i / n, j / n
        dx, dy = 1/n, 1/n

        # 两个三角形
        # 三角形1
        x1, y1, z1 = x0, y0, 0
        x2, y2, z2 = x0 + dx, y0, 0
        x3, y3, z3 = x0, y0 + dy, 0

        v1 = np.sin(np.pi * x1) * np.sin(np.pi * y1)
        v2 = np.sin(np.pi * x2) * np.sin(np.pi * y2)
        v3 = np.sin(np.pi * x3) * np.sin(np.pi * y3)

        data.extend([x1,y1,z1, x2,y2,z2, x3,y3,z3, v1,v2,v3])

        # 三角形2
        x1, y1, z1 = x0 + dx, y0 + dy, 0
        x2, y2, z2 = x0, y0 + dy, 0
        x3, y3, z3 = x0 + dx, y0, 0

        v1 = np.sin(np.pi * x1) * np.sin(np.pi * y1)
        v2 = np.sin(np.pi * x2) * np.sin(np.pi * y2)
        v3 = np.sin(np.pi * x3) * np.sin(np.pi * y3)

        data.extend([x1,y1,z1, x2,y2,z2, x3,y3,z3, v1,v2,v3])

num_triangles = len(data) // 12
gmsh.view.addListData(view, "ST", num_triangles, data)

gmsh.view.write(view, "triangle_scalar.pos")
gmsh.finalize()
```

### 四面体数据

```python
#!/usr/bin/env python3
"""
创建四面体标量数据
"""
import gmsh
import numpy as np

gmsh.initialize()

view = gmsh.view.add("TetraScalar")

# 格式: [x1,y1,z1, x2,y2,z2, x3,y3,z3, x4,y4,z4, v1,v2,v3,v4]
data = []

# 单个四面体示例
vertices = [
    (0, 0, 0),
    (1, 0, 0),
    (0.5, 1, 0),
    (0.5, 0.5, 1)
]

# 坐标
for v in vertices:
    data.extend(v)

# 值
for v in vertices:
    x, y, z = v
    value = x + y + z
    data.append(value)

gmsh.view.addListData(view, "SS", 1, data)

gmsh.view.write(view, "tetra_scalar.pos")
gmsh.finalize()
```

## 时间序列

### 多时间步数据

```python
#!/usr/bin/env python3
"""
创建时间序列列表数据
"""
import gmsh
import numpy as np

gmsh.initialize()

view = gmsh.view.add("WaveAnimation")

# 网格参数
n = 20
num_steps = 50

for step in range(num_steps):
    time = step * 0.1
    data = []

    for i in range(n):
        for j in range(n):
            x = i / (n - 1) * 2 - 1
            y = j / (n - 1) * 2 - 1
            z = 0

            r = np.sqrt(x**2 + y**2)
            value = np.sin(2 * np.pi * (r - time)) * np.exp(-r)

            data.extend([x, y, z, value])

    # 添加带时间戳的数据
    gmsh.view.addListDataString(view, [0, 1.1, 0], [f"Time: {time:.2f}"])
    gmsh.view.addListData(view, "SP", len(data)//4, data, numSteps=step+1)

# 或使用addHomogeneousModelData批量添加

gmsh.view.write(view, "wave_animation.pos")
gmsh.finalize()
```

### 批量添加时间步

```python
# 使用列表数据的时间步
# 在data数组中，每个元素后面追加多个时间步的值

view = gmsh.view.add("MultiStep")

# 单点多时间步
# 格式: [x, y, z, v_t0, v_t1, v_t2, ...]
x, y, z = 0.5, 0.5, 0
values_over_time = [np.sin(t * 0.1) for t in range(20)]

data = [x, y, z] + values_over_time

# 指定时间步数
gmsh.view.addListData(view, "SP", 1, data, numSteps=len(values_over_time))
```

## POS文件格式

### 手动创建POS文件

```python
#!/usr/bin/env python3
"""
直接写入POS文件
"""
import numpy as np

# 创建POS文件
with open("custom.pos", "w") as f:
    f.write('View "CustomField" {\n')

    # 写入点数据
    n = 10
    for i in range(n):
        for j in range(n):
            x, y, z = i/n, j/n, 0
            value = np.sin(np.pi * x) * np.sin(np.pi * y)
            f.write(f"SP({x}, {y}, {z}){{{value}}};\n")

    # 写入三角形数据
    f.write("// Triangles\n")
    f.write("ST(0,0,0, 1,0,0, 0.5,1,0){0.1, 0.2, 0.3};\n")

    # 写入向量数据
    f.write("// Vectors\n")
    f.write("VP(0.5, 0.5, 0){1, 0, 0};\n")

    f.write("};\n")

# 在Gmsh中加载
import gmsh
gmsh.initialize()
gmsh.merge("custom.pos")
gmsh.finalize()
```

### POS文件语法

```
View "ViewName" {
    // 点数据
    SP(x, y, z){value};                          // 标量点
    VP(x, y, z){vx, vy, vz};                     // 向量点
    TP(x, y, z){t11,t12,t13,t21,t22,t23,t31,t32,t33}; // 张量点

    // 线数据
    SL(x1,y1,z1, x2,y2,z2){v1, v2};
    VL(x1,y1,z1, x2,y2,z2){vx1,vy1,vz1, vx2,vy2,vz2};

    // 三角形数据
    ST(x1,y1,z1, x2,y2,z2, x3,y3,z3){v1, v2, v3};
    VT(x1,y1,z1, x2,y2,z2, x3,y3,z3){vx1,vy1,vz1, vx2,vy2,vz2, vx3,vy3,vz3};

    // 四面体数据
    SS(x1,y1,z1, x2,y2,z2, x3,y3,z3, x4,y4,z4){v1,v2,v3,v4};

    // 文本标签
    T3(x, y, z, style){"text"};
    T2(x, y, style){"2D text"};

    // 时间序列（多值）
    SP(x, y, z){v_t0, v_t1, v_t2, ...};
};

// 时间信息
TIME{t0, t1, t2, ...};
```

## 完整示例：热传导可视化

```python
#!/usr/bin/env python3
"""
热传导问题的列表式数据可视化
"""
import gmsh
import numpy as np

def create_temperature_view():
    """创建温度场View"""
    gmsh.initialize()

    # 创建View
    view_temp = gmsh.view.add("Temperature")
    view_flux = gmsh.view.add("HeatFlux")

    # 参数
    Lx, Ly = 2.0, 1.0
    nx, ny = 40, 20
    dx, dy = Lx / nx, Ly / ny

    # 边界条件
    T_left = 100   # 左边温度
    T_right = 20   # 右边温度

    # 稳态解（线性分布）
    temp_data = []
    flux_data = []

    for i in range(nx + 1):
        for j in range(ny + 1):
            x = i * dx
            y = j * dy
            z = 0

            # 温度
            T = T_left + (T_right - T_left) * x / Lx
            temp_data.extend([x, y, z, T])

            # 热流（负梯度方向）
            k = 1.0  # 热导率
            qx = -k * (T_right - T_left) / Lx
            qy = 0
            qz = 0
            flux_data.extend([x, y, z, qx, qy, qz])

    # 添加数据
    gmsh.view.addListData(view_temp, "SP", len(temp_data)//4, temp_data)
    gmsh.view.addListData(view_flux, "VP", len(flux_data)//6, flux_data)

    # 设置显示选项
    # 温度场：颜色映射
    gmsh.option.setNumber("View[0].ColorTable", 3)  # Hot
    gmsh.option.setNumber("View[0].IntervalsType", 1)
    gmsh.option.setNumber("View[0].ShowScale", 1)

    # 热流场：箭头
    gmsh.option.setNumber("View[1].VectorType", 2)
    gmsh.option.setNumber("View[1].ArrowSizeMax", 40)
    gmsh.option.setNumber("View[1].Visible", 1)

    # 保存
    gmsh.view.write(view_temp, "temperature.pos")
    gmsh.view.write(view_flux, "heat_flux.pos")

    # 合并输出
    gmsh.write("heat_transfer.pos")

    gmsh.finalize()

if __name__ == "__main__":
    create_temperature_view()
```

## 列表数据选项

| 选项 | 描述 |
|-----|------|
| numSteps | 时间步数 |
| numComponents | 分量数（标量=1，向量=3，张量=9） |

## 下一步

- [03-模型式数据导入](./03-模型式数据导入.md) - 学习基于网格的数据导入
