# 可视化选项

Gmsh提供丰富的可视化选项来控制数据的显示方式。

## 颜色映射

### 颜色表

```python
import gmsh

gmsh.initialize()

# 设置颜色表
# View[index].ColorTable: 预定义颜色表
# 0: 默认（蓝-绿-红）
# 1: Vis5D
# 2: Jet（蓝-青-绿-黄-红）
# 3: Hot（黑-红-黄-白）
# 4: Gray（灰度）
# 5: HSV（色相循环）

gmsh.option.setNumber("View[0].ColorTable", 2)  # Jet

gmsh.finalize()
```

### 自定义颜色表

```python
# 设置自定义颜色
# 使用RGB值（0-255）

# 设置颜色表中的特定颜色
# 需要通过插件或直接设置option实现

# 反转颜色表
gmsh.option.setNumber("View[0].InvertColorTable", 1)

# 颜色饱和度
gmsh.option.setNumber("View[0].Saturate", 1)
```

### 值范围

```python
# 范围类型
# 1: 自动（默认）
# 2: 自定义
# 3: 每个时间步单独
gmsh.option.setNumber("View[0].RangeType", 2)

# 自定义范围
gmsh.option.setNumber("View[0].CustomMin", 0)
gmsh.option.setNumber("View[0].CustomMax", 100)

# 对数刻度
gmsh.option.setNumber("View[0].ScaleType", 1)  # 0=线性, 1=对数
```

## 显示类型

### 等值线/等值面

```python
# 显示类型
# 1: 颜色（色阶）
# 2: 等值线
# 3: 等值面
# 4: 数值
gmsh.option.setNumber("View[0].IntervalsType", 2)  # 等值线

# 等值线/面数量
gmsh.option.setNumber("View[0].NbIso", 20)

# 等值线宽度
gmsh.option.setNumber("View[0].LineWidth", 1.5)

# 等值线类型
# 0: 无
# 1: 单元边界
# 2: 外边界
# 3: 所有边
gmsh.option.setNumber("View[0].LineType", 1)
```

### 填充显示

```python
# 填充多边形
gmsh.option.setNumber("View[0].Stipple", 0)  # 0=实心, 1=点画

# 平滑
gmsh.option.setNumber("View[0].Smoothing", 1)

# 透明度
gmsh.option.setNumber("View[0].Alpha", 0.8)  # 0-1
gmsh.option.setNumber("View[0].AlphaChannel", 1)  # 启用透明
```

## 向量显示

### 向量类型

```python
# 向量类型
# 1: 线段
# 2: 箭头（2D）
# 3: 金字塔
# 4: 3D箭头（圆锥）
# 5: 位移
# 6: 协方差椭球
gmsh.option.setNumber("View[0].VectorType", 4)
```

### 向量大小

```python
# 箭头尺寸
gmsh.option.setNumber("View[0].ArrowSizeMax", 50)
gmsh.option.setNumber("View[0].ArrowSizeMin", 0)

# 自动缩放
gmsh.option.setNumber("View[0].ArrowSizeProportional", 1)

# 缩放因子
gmsh.option.setNumber("View[0].Normals", 0)  # 法向量显示

# 位移放大系数
gmsh.option.setNumber("View[0].DisplacementFactor", 1.0)
```

### 向量位置

```python
# 向量位置
# 1: 重心
# 2: 节点
gmsh.option.setNumber("View[0].GlyphLocation", 1)

# 向量着色
# 0: 按模值
# 1: 按方向
gmsh.option.setNumber("View[0].ColorMode", 0)
```

## 张量显示

```python
# 张量显示类型
# 1: 主方向
# 2: 最大主应力
# 3: 最小主应力
# 4: von Mises
gmsh.option.setNumber("View[0].TensorType", 4)
```

## 网格显示

### 单元边界

```python
# 显示单元
gmsh.option.setNumber("View[0].ShowElement", 1)

# 单元边宽度
gmsh.option.setNumber("View[0].ElementLineWidth", 0.5)

# 显示节点
gmsh.option.setNumber("Mesh.Points", 1)
gmsh.option.setNumber("Mesh.PointSize", 3)
```

### 外观选项

```python
# 光照
gmsh.option.setNumber("View[0].Light", 1)
gmsh.option.setNumber("View[0].LightLines", 1)
gmsh.option.setNumber("View[0].LightTwoSide", 1)

# 镜面反射
gmsh.option.setNumber("View[0].Shininess", 0.3)
gmsh.option.setNumber("View[0].ShininessExponent", 40)

# 边缘角度（用于法向计算）
gmsh.option.setNumber("View[0].AngleSmooth", 30)
```

## 图例和标注

### 色标

```python
# 显示色标
gmsh.option.setNumber("View[0].ShowScale", 1)

# 色标位置
# 自动布局
gmsh.option.setNumber("View[0].PositionX", 100)
gmsh.option.setNumber("View[0].PositionY", 50)

# 色标尺寸
gmsh.option.setNumber("View[0].Width", 400)
gmsh.option.setNumber("View[0].Height", 300)

# 标签格式
gmsh.option.setString("View[0].Format", "%.3g")

# 标签数量
gmsh.option.setNumber("View[0].NbLabels", 5)
```

### 时间显示

```python
# 显示时间
gmsh.option.setNumber("View[0].ShowTime", 1)

# 时间格式
gmsh.option.setString("View[0].TimeFormat", "Time = %.2f s")
```

### 文本标注

```python
# 使用列表数据添加文本
view = gmsh.view.add("WithText")

# 3D文本
# T3(x, y, z, style){"text"}
gmsh.view.addListDataString(view, [0, 0, 0], ["Origin"])

# 2D文本（屏幕坐标）
# T2(x, y, style){"text"}
gmsh.view.addListDataString(view, [10, 10], ["Title"], dim=2)
```

## 切片和剖面

### 剖面设置

```python
# 使用CutPlane插件
gmsh.plugin.setNumber("CutPlane", "A", 0)  # nx
gmsh.plugin.setNumber("CutPlane", "B", 0)  # ny
gmsh.plugin.setNumber("CutPlane", "C", 1)  # nz
gmsh.plugin.setNumber("CutPlane", "D", -0.5)  # d (ax+by+cz+d=0)
gmsh.plugin.setNumber("CutPlane", "View", 0)
gmsh.plugin.run("CutPlane")
```

### 等值面提取

```python
# 使用Isosurface插件
gmsh.plugin.setNumber("Isosurface", "Value", 50)  # 等值
gmsh.plugin.setNumber("Isosurface", "View", 0)
gmsh.plugin.run("Isosurface")
```

## 完整示例：多View可视化

```python
#!/usr/bin/env python3
"""
多View可视化配置
"""
import gmsh
import numpy as np

gmsh.initialize()
gmsh.model.add("visualization")

# 创建网格
sphere = gmsh.model.occ.addSphere(0, 0, 0, 1)
gmsh.model.occ.synchronize()
gmsh.option.setNumber("Mesh.MeshSizeMax", 0.1)
gmsh.model.mesh.generate(3)

# 获取节点
node_tags, node_coords, _ = gmsh.model.mesh.getNodes()
node_coords = np.array(node_coords).reshape(-1, 3)

# 创建多个View

# View 1: 标量场（温度）
view_temp = gmsh.view.add("Temperature")
temp_data = []
for coords in node_coords:
    x, y, z = coords
    r = np.sqrt(x**2 + y**2 + z**2)
    T = 100 * (1 - r)  # 中心热，外部冷
    temp_data.append([T])

gmsh.view.addModelData(view_temp, 0, "", "NodeData",
                       list(node_tags), temp_data)

# View 2: 向量场（热流）
view_flux = gmsh.view.add("HeatFlux")
flux_data = []
for coords in node_coords:
    x, y, z = coords
    r = max(np.sqrt(x**2 + y**2 + z**2), 0.01)
    # 径向热流（指向外部）
    qx = 100 * x / r
    qy = 100 * y / r
    qz = 100 * z / r
    flux_data.append([qx, qy, qz])

gmsh.view.addModelData(view_flux, 0, "", "NodeData",
                       list(node_tags), flux_data, numComponents=3)

# View 3: 张量场（应力）
view_stress = gmsh.view.add("Stress")
stress_data = []
for coords in node_coords:
    x, y, z = coords
    r = max(np.sqrt(x**2 + y**2 + z**2), 0.01)
    # 简化的球对称应力
    sigma_r = 100 / r**2
    sigma_t = 50 / r**2
    # 转换为笛卡尔坐标
    nx, ny, nz = x/r, y/r, z/r
    tensor = [
        sigma_r*nx*nx + sigma_t*(1-nx*nx),
        (sigma_r-sigma_t)*nx*ny,
        (sigma_r-sigma_t)*nx*nz,
        (sigma_r-sigma_t)*ny*nx,
        sigma_r*ny*ny + sigma_t*(1-ny*ny),
        (sigma_r-sigma_t)*ny*nz,
        (sigma_r-sigma_t)*nz*nx,
        (sigma_r-sigma_t)*nz*ny,
        sigma_r*nz*nz + sigma_t*(1-nz*nz),
    ]
    stress_data.append(tensor)

gmsh.view.addModelData(view_stress, 0, "", "NodeData",
                       list(node_tags), stress_data, numComponents=9)

# 配置View选项

# View 0: 温度场
gmsh.option.setNumber("View[0].Visible", 1)
gmsh.option.setNumber("View[0].ColorTable", 3)  # Hot
gmsh.option.setNumber("View[0].IntervalsType", 1)  # 颜色填充
gmsh.option.setNumber("View[0].ShowScale", 1)
gmsh.option.setNumber("View[0].NbIso", 20)
gmsh.option.setNumber("View[0].RangeType", 2)
gmsh.option.setNumber("View[0].CustomMin", 0)
gmsh.option.setNumber("View[0].CustomMax", 100)
gmsh.option.setString("View[0].Format", "%.1f °C")

# View 1: 热流场
gmsh.option.setNumber("View[1].Visible", 1)
gmsh.option.setNumber("View[1].VectorType", 4)  # 圆锥
gmsh.option.setNumber("View[1].ArrowSizeMax", 30)
gmsh.option.setNumber("View[1].GlyphLocation", 2)  # 节点
gmsh.option.setNumber("View[1].ColorMode", 0)  # 按模值着色

# View 2: 应力场
gmsh.option.setNumber("View[2].Visible", 0)  # 初始隐藏
gmsh.option.setNumber("View[2].TensorType", 4)  # von Mises
gmsh.option.setNumber("View[2].ColorTable", 2)  # Jet

# 全局设置
gmsh.option.setNumber("General.Orthographic", 0)  # 透视投影
gmsh.option.setNumber("General.Light0", 1)  # 光源1
gmsh.option.setNumber("General.Light1", 1)  # 光源2

# 背景颜色
gmsh.option.setColor("General.Background", 255, 255, 255)
gmsh.option.setColor("General.Foreground", 0, 0, 0)

gmsh.write("visualization.msh")
gmsh.finalize()
```

## 视图控制

### 相机设置

```python
# 正交/透视
gmsh.option.setNumber("General.Orthographic", 1)

# 视角
gmsh.option.setNumber("General.RotationX", 45)
gmsh.option.setNumber("General.RotationY", 45)
gmsh.option.setNumber("General.RotationZ", 0)

# 缩放
gmsh.option.setNumber("General.ScaleX", 1)
gmsh.option.setNumber("General.ScaleY", 1)
gmsh.option.setNumber("General.ScaleZ", 1)

# 平移
gmsh.option.setNumber("General.TranslationX", 0)
gmsh.option.setNumber("General.TranslationY", 0)
```

### 裁剪平面

```python
# 启用裁剪
gmsh.option.setNumber("General.ClipWholeElements", 1)

# 裁剪平面方程: A*x + B*y + C*z + D = 0
gmsh.option.setNumber("General.Clip0A", 0)
gmsh.option.setNumber("General.Clip0B", 0)
gmsh.option.setNumber("General.Clip0C", 1)
gmsh.option.setNumber("General.Clip0D", 0)

# 启用裁剪平面0
gmsh.option.setNumber("General.Clip0", 1)
```

## 常用选项汇总

| 类别 | 选项 | 描述 | 值 |
|-----|------|------|---|
| 显示 | Visible | 可见性 | 0/1 |
| 显示 | IntervalsType | 显示类型 | 1-4 |
| 颜色 | ColorTable | 颜色表 | 0-5 |
| 颜色 | RangeType | 范围类型 | 1-3 |
| 向量 | VectorType | 向量类型 | 1-6 |
| 向量 | ArrowSizeMax | 箭头大小 | 0-100 |
| 张量 | TensorType | 张量类型 | 1-4 |
| 等值 | NbIso | 等值线数 | 1-100 |
| 图例 | ShowScale | 显示色标 | 0/1 |
| 光照 | Light | 启用光照 | 0/1 |

## 下一步

- [05-动画与导出](./05-动画与导出.md) - 学习动画制作和图像导出
