# 元素类型参考

本节提供Gmsh支持的所有元素类型的完整参考，包括MSH元素类型代码、节点排列和几何特性。

## 元素类型概览

### 按维度分类

| 维度 | 线性元素 | 二次元素 | 高阶元素 |
|------|---------|---------|---------|
| 0D | 点(15) | - | - |
| 1D | 线段(1) | 3节点线(8) | 4-n节点线 |
| 2D | 三角形(2), 四边形(3) | 6节点三角(9), 9节点四边(10) | 高阶三角/四边形 |
| 3D | 四面体(4), 六面体(5), 棱柱(6), 金字塔(7) | 10节点四面体(11)等 | 高阶体元素 |

## 线性元素（1阶）

### 点元素

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Point | 15 | 1 | 点元素 |

```
节点编号:
    *
    0
```

### 线段元素

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Line | 1 | 2 | 2节点线段 |

```
节点编号:
    0-----------1
```

### 三角形元素

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Triangle | 2 | 3 | 3节点三角形 |

```
节点编号:
         2
        /\
       /  \
      /    \
     /      \
    0--------1
```

### 四边形元素

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Quadrangle | 3 | 4 | 4节点四边形 |

```
节点编号:
    3-----------2
    |           |
    |           |
    |           |
    |           |
    0-----------1
```

### 四面体元素

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Tetrahedron | 4 | 4 | 4节点四面体 |

```
节点编号:
           3
          /|\
         / | \
        /  |  \
       /   |   \
      /    |    \
     0-----|-----2
      \    |    /
       \   |   /
        \  |  /
         \ | /
          \|/
           1
```

### 六面体元素

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Hexahedron | 5 | 8 | 8节点六面体 |

```
节点编号:
        7-----------6
       /|          /|
      / |         / |
     /  |        /  |
    4-----------5   |
    |   |       |   |
    |   3-------|---2
    |  /        |  /
    | /         | /
    |/          |/
    0-----------1
```

### 棱柱元素

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Prism | 6 | 6 | 6节点三棱柱 |

```
节点编号:
        5
       /|\
      / | \
     /  |  \
    3-------4
    |   2   |
    |  / \  |
    | /   \ |
    |/     \|
    0-------1
```

### 金字塔元素

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Pyramid | 7 | 5 | 5节点金字塔 |

```
节点编号:
           4
          /|\
         / | \
        /  |  \
       /   |   \
      3----|----2
     /     |    /
    /      |   /
   /       |  /
  0--------|-1
```

## 二次元素（2阶）

### 二次线段

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Line3 | 8 | 3 | 3节点二次线段 |

```
节点编号:
    0-----2-----1
```

### 二次三角形

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Triangle6 | 9 | 6 | 6节点二次三角形 |

```
节点编号:
         2
        /\
       /  \
      5    4
     /      \
    /        \
   0----3-----1
```

### 二次四边形

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Quadrangle9 | 10 | 9 | 9节点二次四边形（完全） |
| Quadrangle8 | 16 | 8 | 8节点二次四边形（Serendipity） |

```
9节点四边形:
    3-----6-----2
    |           |
    |           |
    7     8     5
    |           |
    |           |
    0-----4-----1

8节点四边形（无中心节点）:
    3-----6-----2
    |           |
    |           |
    7           5
    |           |
    |           |
    0-----4-----1
```

### 二次四面体

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Tetrahedron10 | 11 | 10 | 10节点二次四面体 |

```
节点编号:
           3
          /|\
         / | \
        7  |  9
       /   8   \
      /    |    \
     0-----|-----2
      \    |    /
       4   |   6
        \  |  /
         \ | /
          \|/
           1

边中点:
  边0-1: 节点4
  边1-2: 节点5
  边0-2: 节点6
  边0-3: 节点7
  边1-3: 节点8
  边2-3: 节点9
```

### 二次六面体

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Hexahedron27 | 12 | 27 | 27节点完全二次六面体 |
| Hexahedron20 | 17 | 20 | 20节点Serendipity六面体 |

```
27节点六面体:
        7-----14----6
       /|          /|
     15 |  25    13 |
     /  19   /    / 18
    4-----12----5   |
    |   |       |   |
    |   3---10--|---2
   16  / 21  26 17 /
    | 11   23   | 9
    |/          |/
    0-----8-----1

边中点: 8-19
面中点: 20-25
体中点: 26

20节点六面体（无面/体中心节点）:
  顶点: 0-7
  边中点: 8-19
```

### 二次棱柱

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Prism18 | 13 | 18 | 18节点二次棱柱 |
| Prism15 | 18 | 15 | 15节点Serendipity棱柱 |

### 二次金字塔

| 类型 | MSH代码 | 节点数 | 描述 |
|------|---------|--------|------|
| Pyramid14 | 14 | 14 | 14节点二次金字塔 |
| Pyramid13 | 19 | 13 | 13节点Serendipity金字塔 |

## 高阶元素（3阶及以上）

### 高阶线段

| 类型 | MSH代码 | 节点数 | 阶次 |
|------|---------|--------|------|
| Line4 | 26 | 4 | 3次 |
| Line5 | 27 | 5 | 4次 |
| Line6 | 28 | 6 | 5次 |
| Line7 | 62 | 7 | 6次 |
| Line8 | 63 | 8 | 7次 |
| Line9 | 64 | 9 | 8次 |
| Line10 | 65 | 10 | 9次 |
| Line11 | 66 | 11 | 10次 |

### 高阶三角形

| 类型 | MSH代码 | 节点数 | 阶次 |
|------|---------|--------|------|
| Triangle10 | 21 | 10 | 3次 |
| Triangle15 | 23 | 15 | 4次 |
| Triangle21 | 25 | 21 | 5次 |
| Triangle28 | 42 | 28 | 6次 |
| Triangle36 | 43 | 36 | 7次 |
| Triangle45 | 44 | 45 | 8次 |
| Triangle55 | 45 | 55 | 9次 |
| Triangle66 | 46 | 66 | 10次 |

### 高阶四边形

| 类型 | MSH代码 | 节点数 | 阶次 |
|------|---------|--------|------|
| Quadrangle16 | 36 | 16 | 3次 |
| Quadrangle25 | 37 | 25 | 4次 |
| Quadrangle36 | 38 | 36 | 5次 |

### 高阶四面体

| 类型 | MSH代码 | 节点数 | 阶次 |
|------|---------|--------|------|
| Tetrahedron20 | 29 | 20 | 3次 |
| Tetrahedron35 | 30 | 35 | 4次 |
| Tetrahedron56 | 31 | 56 | 5次 |
| Tetrahedron84 | 71 | 84 | 6次 |
| Tetrahedron120 | 72 | 120 | 7次 |
| Tetrahedron165 | 73 | 165 | 8次 |
| Tetrahedron220 | 74 | 220 | 9次 |
| Tetrahedron286 | 75 | 286 | 10次 |

### 高阶六面体

| 类型 | MSH代码 | 节点数 | 阶次 |
|------|---------|--------|------|
| Hexahedron64 | 92 | 64 | 3次 |
| Hexahedron125 | 93 | 125 | 4次 |

## MSH元素类型完整列表

```python
"""
获取Gmsh元素类型信息
"""
import gmsh

gmsh.initialize()

# 常用元素类型
element_types = {
    # 0D
    15: "Point",

    # 1D线性
    1: "Line (2 nodes)",

    # 1D二次
    8: "Line (3 nodes, 2nd order)",
    26: "Line (4 nodes, 3rd order)",
    27: "Line (5 nodes, 4th order)",
    28: "Line (6 nodes, 5th order)",

    # 2D线性
    2: "Triangle (3 nodes)",
    3: "Quadrangle (4 nodes)",

    # 2D二次
    9: "Triangle (6 nodes, 2nd order)",
    10: "Quadrangle (9 nodes, 2nd order)",
    16: "Quadrangle (8 nodes, 2nd order Serendipity)",

    # 2D高阶
    21: "Triangle (10 nodes, 3rd order)",
    23: "Triangle (15 nodes, 4th order)",
    25: "Triangle (21 nodes, 5th order)",
    36: "Quadrangle (16 nodes, 3rd order)",
    37: "Quadrangle (25 nodes, 4th order)",

    # 3D线性
    4: "Tetrahedron (4 nodes)",
    5: "Hexahedron (8 nodes)",
    6: "Prism (6 nodes)",
    7: "Pyramid (5 nodes)",

    # 3D二次
    11: "Tetrahedron (10 nodes, 2nd order)",
    12: "Hexahedron (27 nodes, 2nd order)",
    17: "Hexahedron (20 nodes, 2nd order Serendipity)",
    13: "Prism (18 nodes, 2nd order)",
    18: "Prism (15 nodes, 2nd order Serendipity)",
    14: "Pyramid (14 nodes, 2nd order)",
    19: "Pyramid (13 nodes, 2nd order Serendipity)",

    # 3D高阶
    29: "Tetrahedron (20 nodes, 3rd order)",
    30: "Tetrahedron (35 nodes, 4th order)",
    31: "Tetrahedron (56 nodes, 5th order)",
}

# 打印元素类型信息
print("常用MSH元素类型:")
print("-" * 60)
for code, name in sorted(element_types.items()):
    print(f"  {code:3d}: {name}")

# 使用API获取元素属性
print("\n元素属性详情:")
print("-" * 60)
for code in [1, 2, 3, 4, 5]:
    try:
        name, dim, order, numNodes, localNodeCoord, numPrimaryNodes = \
            gmsh.model.mesh.getElementProperties(code)
        print(f"类型 {code}:")
        print(f"  名称: {name}")
        print(f"  维度: {dim}")
        print(f"  阶次: {order}")
        print(f"  节点数: {numNodes}")
        print(f"  主节点数: {numPrimaryNodes}")
    except:
        pass

gmsh.finalize()
```

## 元素局部坐标系

### 三角形参考坐标

```
参考三角形 (u, v) ∈ [0,1], u+v ≤ 1

  v
  ^
  |
  1  2
  |  |\
  |  | \
  |  |  \
  0  0---1 --> u
     0   1

顶点坐标:
  节点0: (0, 0)
  节点1: (1, 0)
  节点2: (0, 1)
```

### 四边形参考坐标

```
参考四边形 (u, v) ∈ [-1,1] × [-1,1]

  v
  ^
  |
  1  3-----2
  |  |     |
  |  |     |
  |  |     |
 -1  0-----1 --> u
    -1     1

顶点坐标:
  节点0: (-1, -1)
  节点1: ( 1, -1)
  节点2: ( 1,  1)
  节点3: (-1,  1)
```

### 四面体参考坐标

```
参考四面体 (u, v, w) ∈ [0,1], u+v+w ≤ 1

顶点坐标:
  节点0: (0, 0, 0)
  节点1: (1, 0, 0)
  节点2: (0, 1, 0)
  节点3: (0, 0, 1)

面定义:
  面0: 节点 1-2-3 (对面节点0)
  面1: 节点 0-3-2 (对面节点1)
  面2: 节点 0-1-3 (对面节点2)
  面3: 节点 0-2-1 (对面节点3)
```

### 六面体参考坐标

```
参考六面体 (u, v, w) ∈ [-1,1]³

顶点坐标:
  节点0: (-1, -1, -1)
  节点1: ( 1, -1, -1)
  节点2: ( 1,  1, -1)
  节点3: (-1,  1, -1)
  节点4: (-1, -1,  1)
  节点5: ( 1, -1,  1)
  节点6: ( 1,  1,  1)
  节点7: (-1,  1,  1)

面定义:
  面0: 节点 0-3-2-1 (w=-1)
  面1: 节点 4-5-6-7 (w=+1)
  面2: 节点 0-1-5-4 (v=-1)
  面3: 节点 2-3-7-6 (v=+1)
  面4: 节点 0-4-7-3 (u=-1)
  面5: 节点 1-2-6-5 (u=+1)
```

## 节点数计算公式

### 单纯形元素

**n阶n维单纯形的节点数：**

$$N = \binom{n+d}{d} = \frac{(n+d)!}{n! \cdot d!}$$

其中：
- n = 多项式阶次
- d = 维度（线段=1，三角形=2，四面体=3）

| 阶次 | 线段(d=1) | 三角形(d=2) | 四面体(d=3) |
|------|-----------|-------------|-------------|
| 1 | 2 | 3 | 4 |
| 2 | 3 | 6 | 10 |
| 3 | 4 | 10 | 20 |
| 4 | 5 | 15 | 35 |
| 5 | 6 | 21 | 56 |

### 张量积元素

**n阶d维张量积元素的节点数：**

$$N = (n+1)^d$$

| 阶次 | 线段 | 四边形 | 六面体 |
|------|------|--------|--------|
| 1 | 2 | 4 | 8 |
| 2 | 3 | 9 | 27 |
| 3 | 4 | 16 | 64 |
| 4 | 5 | 25 | 125 |

## 使用示例

### 查询元素类型

```python
import gmsh

gmsh.initialize()
gmsh.model.add("element_query")

# 创建简单几何并生成网格
gmsh.model.occ.addBox(0, 0, 0, 1, 1, 1)
gmsh.model.occ.synchronize()
gmsh.model.mesh.generate(3)

# 获取元素类型
elem_types = gmsh.model.mesh.getElementTypes(3)  # 3D元素
print(f"3D元素类型: {elem_types}")

# 获取特定类型的属性
for etype in elem_types:
    props = gmsh.model.mesh.getElementProperties(etype)
    print(f"\n类型 {etype}:")
    print(f"  名称: {props[0]}")
    print(f"  维度: {props[1]}")
    print(f"  阶次: {props[2]}")
    print(f"  节点数: {props[3]}")

gmsh.finalize()
```

### 设置高阶元素

```python
import gmsh

gmsh.initialize()
gmsh.model.add("high_order")

# 创建几何
gmsh.model.occ.addSphere(0, 0, 0, 1)
gmsh.model.occ.synchronize()

# 生成线性网格
gmsh.model.mesh.generate(3)

# 转换为二阶
gmsh.model.mesh.setOrder(2)

# 检查元素类型
elem_types = gmsh.model.mesh.getElementTypes(3)
for etype in elem_types:
    props = gmsh.model.mesh.getElementProperties(etype)
    print(f"类型 {etype}: {props[0]}, 阶次={props[2]}, 节点数={props[3]}")

# 可以继续提升到更高阶
gmsh.model.mesh.setOrder(3)

gmsh.write("high_order.msh")
gmsh.finalize()
```

### 获取元素连接性

```python
import gmsh
import numpy as np

gmsh.initialize()
gmsh.open("mesh.msh")

# 获取所有四面体
elem_types, elem_tags, elem_nodes = gmsh.model.mesh.getElements(3)

for i, etype in enumerate(elem_types):
    props = gmsh.model.mesh.getElementProperties(etype)
    num_nodes = props[3]

    # 重塑连接性数组
    connectivity = elem_nodes[i].reshape(-1, num_nodes)

    print(f"元素类型 {etype} ({props[0]}):")
    print(f"  元素数: {len(elem_tags[i])}")
    print(f"  每元素节点数: {num_nodes}")
    print(f"  前3个元素的节点:")
    for j in range(min(3, len(connectivity))):
        print(f"    元素 {elem_tags[i][j]}: {connectivity[j]}")

gmsh.finalize()
```

## 小结

本节介绍了Gmsh支持的元素类型：

1. **线性元素**：点、线段、三角形、四边形、四面体、六面体、棱柱、金字塔
2. **二次元素**：各类型的二阶版本（Lagrange和Serendipity）
3. **高阶元素**：3阶至10阶的单纯形和张量积元素
4. **参考坐标系**：各元素类型的局部坐标定义
5. **节点编号**：标准节点排列约定

正确理解元素类型对于：
- 导出到特定求解器
- 实现自定义后处理
- 理解网格数据结构

都是非常重要的。
