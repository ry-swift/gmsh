# 内置几何内核 (gmsh.model.geo)

内置几何内核是Gmsh的默认几何引擎，适合创建简单到中等复杂度的几何模型。

## API 命名空间

```python
gmsh.model.geo.*  # 所有内置几何操作
```

## 点 (Point)

### 创建点

```python
# addPoint(x, y, z, meshSize=0, tag=-1)
# 返回：点的tag

# 基本用法
p1 = gmsh.model.geo.addPoint(0, 0, 0, 0.1)      # 自动分配tag
p2 = gmsh.model.geo.addPoint(1, 0, 0, 0.1, 2)   # 指定tag=2

# meshSize参数控制该点处的网格尺寸
# meshSize=0 表示使用全局默认尺寸
p3 = gmsh.model.geo.addPoint(2, 0, 0, 0)  # 使用默认尺寸
```

### 参数说明

| 参数 | 类型 | 描述 |
|-----|------|------|
| x, y, z | float | 点的坐标 |
| meshSize | float | 该点处的目标网格尺寸（0表示默认） |
| tag | int | 点的标签（-1表示自动分配） |

## 曲线 (Curve)

### 直线 (Line)

```python
# addLine(startTag, endTag, tag=-1)
# 返回：线的tag

l1 = gmsh.model.geo.addLine(1, 2)      # 从点1到点2
l2 = gmsh.model.geo.addLine(2, 3, 5)   # 指定tag=5
```

### 圆弧 (Circle Arc)

```python
# addCircleArc(startTag, centerTag, endTag, tag=-1, nx=0, ny=0, nz=0)
# 创建经过起点、围绕圆心、到达终点的圆弧

# 圆弧必须小于180度！
# 如需完整圆，需要两条或多条圆弧

# 示例：创建半圆
p1 = gmsh.model.geo.addPoint(1, 0, 0, 0.1)   # 起点
p2 = gmsh.model.geo.addPoint(0, 0, 0, 0.1)   # 圆心
p3 = gmsh.model.geo.addPoint(-1, 0, 0, 0.1)  # 终点

arc = gmsh.model.geo.addCircleArc(p1, p2, p3)  # 上半圆

# 创建完整圆（需要4条弧或使用circle命令）
p_center = gmsh.model.geo.addPoint(0, 0, 0, 0.1)
p_right = gmsh.model.geo.addPoint(1, 0, 0, 0.1)
p_top = gmsh.model.geo.addPoint(0, 1, 0, 0.1)
p_left = gmsh.model.geo.addPoint(-1, 0, 0, 0.1)
p_bottom = gmsh.model.geo.addPoint(0, -1, 0, 0.1)

arc1 = gmsh.model.geo.addCircleArc(p_right, p_center, p_top)
arc2 = gmsh.model.geo.addCircleArc(p_top, p_center, p_left)
arc3 = gmsh.model.geo.addCircleArc(p_left, p_center, p_bottom)
arc4 = gmsh.model.geo.addCircleArc(p_bottom, p_center, p_right)
```

### 椭圆弧 (Ellipse Arc)

```python
# addEllipseArc(startTag, centerTag, majorTag, endTag, tag=-1, nx=0, ny=0, nz=0)
# majorTag: 长轴端点

p1 = gmsh.model.geo.addPoint(2, 0, 0, 0.1)   # 起点（长轴端点）
p2 = gmsh.model.geo.addPoint(0, 0, 0, 0.1)   # 中心
p3 = gmsh.model.geo.addPoint(2, 0, 0, 0.1)   # 长轴参考点
p4 = gmsh.model.geo.addPoint(0, 1, 0, 0.1)   # 终点（短轴端点）

ellipse_arc = gmsh.model.geo.addEllipseArc(p1, p2, p3, p4)
```

### 样条曲线 (Spline)

```python
# addSpline(pointTags, tag=-1)
# Catmull-Rom样条，经过所有控制点

points = []
for i in range(10):
    x = i * 0.1
    y = math.sin(x * math.pi * 2)
    points.append(gmsh.model.geo.addPoint(x, y, 0, 0.1))

spline = gmsh.model.geo.addSpline(points)
```

### B样条曲线 (BSpline)

```python
# addBSpline(pointTags, tag=-1)
# 三次B样条，不一定经过控制点

bspline = gmsh.model.geo.addBSpline(points)
```

### Bezier曲线

```python
# addBezier(pointTags, tag=-1)
# Bezier曲线

bezier = gmsh.model.geo.addBezier(points)
```

### 折线 (Polyline)

```python
# addPolyline(pointTags, tag=-1)
# 连接多点的折线

polyline = gmsh.model.geo.addPolyline([p1, p2, p3, p4])
```

### 复合曲线 (Compound)

```python
# addCompoundSpline(curveTags, numIntervals=5, tag=-1)
# 将多条曲线组合成一条样条

compound = gmsh.model.geo.addCompoundSpline([l1, l2, l3])

# addCompoundBSpline(curveTags, numIntervals=5, tag=-1)
compound_bspline = gmsh.model.geo.addCompoundBSpline([l1, l2, l3])
```

## 曲线环与曲面

### 曲线环 (Curve Loop)

```python
# addCurveLoop(curveTags, tag=-1, reorient=False)
# curveTags: 曲线列表，正数正向，负数反向
# reorient: 是否自动调整方向

# 基本用法
cl = gmsh.model.geo.addCurveLoop([l1, l2, l3, l4])

# 使用负数表示反向
cl = gmsh.model.geo.addCurveLoop([l1, -l2, l3, -l4])

# 自动重定向
cl = gmsh.model.geo.addCurveLoop([l1, l2, l3, l4], reorient=True)
```

### 自动创建曲线环

```python
# addCurveLoops(curveTags)
# 自动确定方向并创建曲线环
# 返回：曲线环tag列表

loops = gmsh.model.geo.addCurveLoops([l1, l2, l3, l4])
```

### 平面曲面 (Plane Surface)

```python
# addPlaneSurface(wireTags, tag=-1)
# wireTags: [外边界, 孔1, 孔2, ...]
# 第一个是外边界，其余是孔洞

# 简单矩形
s = gmsh.model.geo.addPlaneSurface([cl1])

# 带一个孔
s = gmsh.model.geo.addPlaneSurface([outer_loop, hole_loop])

# 带多个孔
s = gmsh.model.geo.addPlaneSurface([outer_loop, hole1, hole2, hole3])
```

### 填充曲面 (Surface Filling)

```python
# addSurfaceFilling(wireTags, tag=-1, sphereCenterTag=-1)
# 用于非平面曲面

# 创建一般曲面
s = gmsh.model.geo.addSurfaceFilling([cl])

# 指定球心（用于球面等）
s = gmsh.model.geo.addSurfaceFilling([cl], sphereCenterTag=center_point)
```

## 体积 (Volume)

### 曲面环 (Surface Loop)

```python
# addSurfaceLoop(surfaceTags, tag=-1)
# 创建封闭的曲面环

sl = gmsh.model.geo.addSurfaceLoop([s1, s2, s3, s4, s5, s6])
```

### 体积

```python
# addVolume(shellTags, tag=-1)
# shellTags: [外壳, 内空1, 内空2, ...]

# 实心体
v = gmsh.model.geo.addVolume([sl_outer])

# 带空腔的体
v = gmsh.model.geo.addVolume([sl_outer, sl_inner])
```

## 拉伸操作

### 平移拉伸 (Extrude)

```python
# extrude(dimTags, dx, dy, dz, numElements=[], heights=[], recombine=False)
# 返回：(顶面dimTags, 侧面信息)

# 基本拉伸
result = gmsh.model.geo.extrude([(2, 1)], 0, 0, 1)  # 沿Z拉伸1

# 分层拉伸（控制网格层数）
result = gmsh.model.geo.extrude(
    [(2, 1)],
    0, 0, 1,
    numElements=[10],  # 10层
    heights=[1.0]      # 总高度的比例
)

# 多段分层
result = gmsh.model.geo.extrude(
    [(2, 1)],
    0, 0, 1,
    numElements=[5, 10, 5],     # 三段，分别5、10、5层
    heights=[0.2, 0.6, 0.2]     # 占总高度的20%、60%、20%
)

# 结果解析
# result[0]: 顶面 (dim, tag)
# result[1:]: 侧面 (dim, tag)
top_surface = result[0]
side_surfaces = result[1:]
```

### 旋转拉伸 (Revolve)

```python
# revolve(dimTags, x, y, z, ax, ay, az, angle, numElements=[], heights=[], recombine=False)
# (x,y,z): 轴上一点
# (ax,ay,az): 轴方向
# angle: 旋转角度（弧度）

import math

# 绕Z轴旋转360度
result = gmsh.model.geo.revolve(
    [(2, 1)],           # 要旋转的面
    0, 0, 0,            # 轴上的点
    0, 0, 1,            # 轴方向（Z轴）
    2 * math.pi         # 360度
)

# 旋转90度
result = gmsh.model.geo.revolve(
    [(2, 1)],
    0, 0, 0,
    0, 0, 1,
    math.pi / 2  # 90度
)
```

### 扭转拉伸 (Twist)

```python
# twist(dimTags, x, y, z, dx, dy, dz, ax, ay, az, angle, numElements=[], heights=[], recombine=False)
# 沿轴平移的同时旋转

result = gmsh.model.geo.twist(
    [(2, 1)],
    0, 0, 0,      # 起点
    0, 0, 1,      # 平移方向和距离
    0, 0, 1,      # 旋转轴
    math.pi / 4   # 扭转角度
)
```

### 边界层拉伸

```python
# extrudeBoundaryLayer(dimTags, numElements=[1], heights=[1], recombine=False, second=False, viewIndex=-1)
# 用于创建边界层网格

result = gmsh.model.geo.extrudeBoundaryLayer(
    [(2, 1)],
    numElements=[5],    # 5层
    heights=[0.01, 0.02, 0.03, 0.04, 0.05]  # 每层高度
)
```

## 几何变换

### 平移 (Translate)

```python
# translate(dimTags, dx, dy, dz)
# 原地修改实体位置

gmsh.model.geo.translate([(2, 1)], 1, 0, 0)  # X方向平移1
```

### 旋转 (Rotate)

```python
# rotate(dimTags, x, y, z, ax, ay, az, angle)
# (x,y,z): 轴上一点
# (ax,ay,az): 轴方向
# angle: 旋转角度（弧度）

gmsh.model.geo.rotate(
    [(2, 1)],
    0, 0, 0,      # 原点
    0, 0, 1,      # Z轴
    math.pi / 2   # 90度
)
```

### 缩放 (Dilate)

```python
# dilate(dimTags, x, y, z, a, b, c)
# 以(x,y,z)为中心，按(a,b,c)缩放

# 均匀缩放
gmsh.model.geo.dilate([(2, 1)], 0, 0, 0, 2, 2, 2)  # 放大2倍

# 非均匀缩放
gmsh.model.geo.dilate([(2, 1)], 0, 0, 0, 2, 1, 1)  # X方向拉伸
```

### 镜像 (Mirror)

```python
# mirror(dimTags, a, b, c, d)
# 关于平面 ax + by + cz + d = 0 镜像

# 关于XY平面镜像
gmsh.model.geo.mirror([(2, 1)], 0, 0, 1, 0)  # z = 0 平面

# 关于YZ平面镜像
gmsh.model.geo.mirror([(2, 1)], 1, 0, 0, 0)  # x = 0 平面
```

### 对称 (Symmetrize)

```python
# symmetrize(dimTags, a, b, c, d)
# 与mirror类似，但会修改原实体而非创建新实体
gmsh.model.geo.symmetrize([(2, 1)], 0, 0, 1, 0)
```

### 复制 (Copy)

```python
# copy(dimTags)
# 返回：复制后的dimTags

copied = gmsh.model.geo.copy([(2, 1), (2, 2)])
```

### 删除 (Remove)

```python
# remove(dimTags, recursive=False)
# recursive=True: 同时删除低维边界实体

gmsh.model.geo.remove([(2, 1)])  # 只删除面

gmsh.model.geo.remove([(2, 1)], recursive=True)  # 删除面及其边界
```

## 同步

```python
# synchronize()
# 将内置CAD数据同步到Gmsh模型
# 必须在网格生成前调用！

gmsh.model.geo.synchronize()
```

## 完整示例：带孔圆盘

```python
#!/usr/bin/env python3
"""
使用内置几何内核创建带中心孔的圆盘
"""
import gmsh
import math

gmsh.initialize()
gmsh.model.add("disk_with_hole")

lc = 0.1  # 网格尺寸

# 外圆（半径1）
p_center = gmsh.model.geo.addPoint(0, 0, 0, lc)
p_outer_1 = gmsh.model.geo.addPoint(1, 0, 0, lc)
p_outer_2 = gmsh.model.geo.addPoint(0, 1, 0, lc)
p_outer_3 = gmsh.model.geo.addPoint(-1, 0, 0, lc)
p_outer_4 = gmsh.model.geo.addPoint(0, -1, 0, lc)

arc_outer_1 = gmsh.model.geo.addCircleArc(p_outer_1, p_center, p_outer_2)
arc_outer_2 = gmsh.model.geo.addCircleArc(p_outer_2, p_center, p_outer_3)
arc_outer_3 = gmsh.model.geo.addCircleArc(p_outer_3, p_center, p_outer_4)
arc_outer_4 = gmsh.model.geo.addCircleArc(p_outer_4, p_center, p_outer_1)

outer_loop = gmsh.model.geo.addCurveLoop([arc_outer_1, arc_outer_2, arc_outer_3, arc_outer_4])

# 内圆（半径0.3）
p_inner_1 = gmsh.model.geo.addPoint(0.3, 0, 0, lc/2)
p_inner_2 = gmsh.model.geo.addPoint(0, 0.3, 0, lc/2)
p_inner_3 = gmsh.model.geo.addPoint(-0.3, 0, 0, lc/2)
p_inner_4 = gmsh.model.geo.addPoint(0, -0.3, 0, lc/2)

arc_inner_1 = gmsh.model.geo.addCircleArc(p_inner_1, p_center, p_inner_2)
arc_inner_2 = gmsh.model.geo.addCircleArc(p_inner_2, p_center, p_inner_3)
arc_inner_3 = gmsh.model.geo.addCircleArc(p_inner_3, p_center, p_inner_4)
arc_inner_4 = gmsh.model.geo.addCircleArc(p_inner_4, p_center, p_inner_1)

inner_loop = gmsh.model.geo.addCurveLoop([arc_inner_1, arc_inner_2, arc_inner_3, arc_inner_4])

# 创建带孔的平面
surface = gmsh.model.geo.addPlaneSurface([outer_loop, inner_loop])

# 同步
gmsh.model.geo.synchronize()

# 定义物理组
gmsh.model.addPhysicalGroup(1, [arc_outer_1, arc_outer_2, arc_outer_3, arc_outer_4], name="outer_boundary")
gmsh.model.addPhysicalGroup(1, [arc_inner_1, arc_inner_2, arc_inner_3, arc_inner_4], name="inner_boundary")
gmsh.model.addPhysicalGroup(2, [surface], name="disk")

# 生成网格
gmsh.model.mesh.generate(2)

# 保存
gmsh.write("disk_with_hole.msh")

# 可视化
# gmsh.fltk.run()

gmsh.finalize()
print("完成！")
```

## 下一步

学习完内置几何内核后，请继续：
- [03-OpenCASCADE内核](./03-OpenCASCADE内核.md) - 学习更强大的OCC内核
