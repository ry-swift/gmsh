# Gmsh Tutorial 1 - 逐行注释与翻译

## 文件概述

**文件路径**: `tutorials/t1.geo`
**主题**: 几何基础、基本实体、物理分组
**难度**: 入门级

这是 Gmsh 的第一个教程文件，介绍了最基本的几何建模概念。通过这个教程，我们将学习如何创建点、线、曲线环、平面和物理分组。

---

## 逐行详解

### 第 1-7 行：文件头注释

```geo
// -----------------------------------------------------------------------------
//
//  Gmsh GEO tutorial 1
//
//  Geometry basics, elementary entities, physical groups
//
// -----------------------------------------------------------------------------
```

**翻译**:
```
// -----------------------------------------------------------------------------
//
//  Gmsh GEO 教程 1
//
//  几何基础、基本实体、物理分组
//
// -----------------------------------------------------------------------------
```

**解析**:
- `//` 是 Gmsh 脚本的单行注释符号
- 这是文件的标题块，说明这是第一个教程
- "elementary entities" 指的是 Gmsh 中的基本几何实体（点、线、面、体）
- "physical groups" 是用于将几何实体分组的机制，便于后续网格导出和物理属性定义

---

### 第 9-12 行：变量定义

```geo
// The simplest construction in Gmsh's scripting language is the
// `affectation'. The following command defines a new variable `lc':

lc = 1e-2;
```

**翻译**:
```
// Gmsh 脚本语言中最简单的结构是"赋值"操作。
// 下面的命令定义了一个名为 `lc` 的新变量：

lc = 1e-2;
```

**解析**:
- `lc` 是 "characteristic length"（特征长度）的缩写
- `1e-2` 表示 0.01（科学计数法）
- 这个变量将用于控制网格元素的尺寸大小
- Gmsh 的变量赋值语法与 C 语言类似，需要以分号结尾

**重点概念**:
- **特征长度 (lc)**: 控制网格在某点附近的元素大小。值越小，生成的网格越精细，计算量也越大。

---

### 第 14-20 行：定义第一个点

```geo
// This variable can then be used in the definition of Gmsh's simplest
// `elementary entity', a `Point'. A Point is uniquely identified by a tag (a
// strictly positive integer; here `1') and defined by a list of four numbers:
// three coordinates (X, Y and Z) and the target mesh size (lc) close to the
// point:

Point(1) = {0, 0, 0, lc};
```

**翻译**:
```
// 这个变量随后可用于定义 Gmsh 最简单的"基本实体"——"点"。
// 一个点由唯一的标签（一个严格的正整数，这里是 `1`）来标识，
// 并由四个数字的列表定义：三个坐标 (X, Y 和 Z) 以及该点附近的
// 目标网格尺寸 (lc)：

Point(1) = {0, 0, 0, lc};
```

**解析**:
- `Point(1)`: 创建标签为 1 的点
- `{0, 0, 0, lc}`:
  - 前三个值是点的 X、Y、Z 坐标
  - 第四个值 `lc` 是该点附近的目标网格尺寸
- 语法格式: `Point(tag) = {x, y, z, mesh_size};`

**语法要点**:
| 参数 | 含义 | 本例值 |
|------|------|--------|
| tag | 点的唯一标识符（正整数） | 1 |
| x | X 坐标 | 0 |
| y | Y 坐标 | 0 |
| z | Z 坐标 | 0 |
| mesh_size | 目标网格尺寸 | 0.01 |

---

### 第 22-28 行：网格尺寸说明

```geo
// The distribution of the mesh element sizes will then be obtained by
// interpolation of these mesh sizes throughout the geometry. Another method to
// specify mesh sizes is to use general mesh size Fields (see `t10.geo'). A
// particular case is the use of a background mesh (see `t7.geo').

// If no target mesh size of provided, a default uniform coarse size will be
// used for the model, based on the overall model size.
```

**翻译**:
```
// 网格元素尺寸的分布将通过在整个几何体中对这些网格尺寸进行插值来获得。
// 另一种指定网格尺寸的方法是使用通用的网格尺寸场（参见 `t10.geo`）。
// 一个特殊情况是使用背景网格（参见 `t7.geo`）。

// 如果没有提供目标网格尺寸，将根据模型的整体尺寸使用默认的均匀粗网格尺寸。
```

**重要概念**:
1. **插值**: Gmsh 会在各点之间平滑地过渡网格尺寸
2. **尺寸场 (Fields)**: 更高级的网格尺寸控制方法，将在 t10.geo 中学习
3. **背景网格**: 使用已有网格来定义新网格的尺寸，将在 t7.geo 中学习

---

### 第 30-35 行：定义其他点

```geo
// We can then define some additional points. All points should have different
// tags:

Point(2) = {.1, 0,  0, lc};
Point(3) = {.1, .3, 0, lc};
Point(4) = {0,  .3, 0, lc};
```

**翻译**:
```
// 然后我们可以定义一些额外的点。所有点应该有不同的标签：

Point(2) = {.1, 0,  0, lc};   // 点2: (0.1, 0, 0)
Point(3) = {.1, .3, 0, lc};   // 点3: (0.1, 0.3, 0)
Point(4) = {0,  .3, 0, lc};   // 点4: (0, 0.3, 0)
```

**解析**:
- `.1` 是 `0.1` 的简写形式
- `.3` 是 `0.3` 的简写形式
- 所有点都在 Z=0 的平面上（二维几何）

**四个点的坐标可视化**:
```
    Y
    ^
    |
0.3 +   4--------3
    |   |        |
    |   |        |
    |   |        |
  0 +---1--------2----> X
    0        0.1
```

---

### 第 37-49 行：定义直线

```geo
// Curves are Gmsh's second type of elementary entities, and, amongst curves,
// straight lines are the simplest. A straight line is identified by a tag and
// is defined by a list of two point tags. In the commands below, for example,
// the line 1 starts at point 1 and ends at point 2.
//
// Note that curve tags are separate from point tags - hence we can reuse tag
// `1' for our first curve. And as a general rule, elementary entity tags in
// Gmsh have to be unique per geometrical dimension.

Line(1) = {1, 2};
Line(2) = {3, 2};
Line(3) = {3, 4};
Line(4) = {4, 1};
```

**翻译**:
```
// 曲线是 Gmsh 的第二种基本实体，而在曲线中，直线是最简单的。
// 直线由标签标识，并由两个点标签的列表定义。例如，在下面的命令中，
// 线 1 从点 1 开始，在点 2 结束。
//
// 注意曲线标签与点标签是分开的——因此我们可以为第一条曲线重用标签 `1`。
// 作为一般规则，Gmsh 中的基本实体标签在每个几何维度内必须唯一。

Line(1) = {1, 2};   // 线1: 从点1到点2（底边）
Line(2) = {3, 2};   // 线2: 从点3到点2（右边，注意方向是向下的）
Line(3) = {3, 4};   // 线3: 从点3到点4（顶边）
Line(4) = {4, 1};   // 线4: 从点4到点1（左边）
```

**语法格式**: `Line(tag) = {start_point, end_point};`

**关键概念**:
1. **标签独立性**: 点和线的标签是独立的命名空间
   - Point(1) 和 Line(1) 可以同时存在
2. **维度唯一性**: 同一维度内标签必须唯一
   - 不能有两个 Line(1)
3. **方向性**: 线有方向，从起点指向终点

**线的方向可视化**:
```
         线3 (3→4)
    4 <------------ 3
    |               ^
    |               |
线4 |               | 线2 (3→2)
(4→1)               |
    v               |
    1 ------------> 2
         线1 (1→2)
```

---

### 第 51-58 行：定义曲线环

```geo
// The third elementary entity is the surface. In order to define a simple
// rectangular surface from the four curves defined above, a curve loop has
// first to be defined. A curve loop is also identified by a tag (unique amongst
// curve loops) and defined by an ordered list of connected curves, a sign being
// associated with each curve (depending on the orientation of the curve to form
// a loop):

Curve Loop(1) = {4, 1, -2, 3};
```

**翻译**:
```
// 第三种基本实体是曲面。为了从上面定义的四条曲线创建一个简单的矩形曲面，
// 首先需要定义一个曲线环。曲线环也由标签标识（在曲线环中唯一），
// 并由一个有序的连接曲线列表定义，每条曲线关联一个符号
// （取决于曲线的方向以形成一个环）：

Curve Loop(1) = {4, 1, -2, 3};
```

**解析**:
- `Curve Loop(1)`: 创建标签为 1 的曲线环
- `{4, 1, -2, 3}`: 按顺序连接的曲线列表
  - 正数: 使用曲线的原始方向
  - 负数: 使用曲线的反向

**曲线环形成过程**:
```
起点: 点4
  ↓ 线4 (4→1): 到达点1
  ↓ 线1 (1→2): 到达点2
  ↓ 线-2 (2→3): 线2反向，从点2到点3
  ↓ 线3 (3→4): 到达点4（回到起点，闭合）
```

**为什么线2需要取反？**
- 线2 的定义是 `Line(2) = {3, 2}`，即从点3到点2
- 但在环中，我们需要从点2走到点3
- 因此使用 `-2` 表示反向使用这条线

**曲线环方向规则**:
- 逆时针方向 → 曲面法向量指向外部（正向）
- 顺时针方向 → 曲面法向量指向内部（负向）

---

### 第 60-64 行：定义平面

```geo
// We can then define the surface as a list of curve loops (only one here,
// representing the external contour, since there are no holes--see `t4.geo' for
// an example of a surface with a hole):

Plane Surface(1) = {1};
```

**翻译**:
```
// 然后我们可以将曲面定义为曲线环的列表（这里只有一个，
// 表示外部轮廓，因为没有孔洞——参见 `t4.geo` 了解带孔曲面的示例）：

Plane Surface(1) = {1};
```

**解析**:
- `Plane Surface(1)`: 创建标签为 1 的平面
- `{1}`: 使用曲线环 1 作为边界
- 如果有孔洞，列表会包含多个曲线环，例如 `{1, 2, 3}` 表示外边界 1，孔洞边界 2 和 3

**语法格式**: `Plane Surface(tag) = {curve_loop_1, curve_loop_2, ...};`

**带孔洞的曲面示例**:
```geo
// 外边界
Curve Loop(1) = {...};
// 孔洞1
Curve Loop(2) = {...};
// 孔洞2
Curve Loop(3) = {...};
// 带两个孔的曲面
Plane Surface(1) = {1, 2, 3};
```

---

### 第 66-85 行：物理分组

```geo
// At this level, Gmsh knows everything to display the rectangular surface 1 and
// to mesh it. An optional step is needed if we want to group elementary
// geometrical entities into more meaningful groups, e.g. to define some
// mathematical ("domain", "boundary"), functional ("left wing", "fuselage") or
// material ("steel", "carbon") properties.
//
// Such groups are called "Physical Groups" in Gmsh. By default, if physical
// groups are defined, Gmsh will export in output files only mesh elements that
// belong to at least one physical group. (To force Gmsh to save all elements,
// whether they belong to physical groups or not, set `Mesh.SaveAll=1;', or
// specify `-save_all' on the command line.) Physical groups are also identified
// by tags, i.e. strictly positive integers, that should be unique per dimension
// (0D, 1D, 2D or 3D). Physical groups can also be given names.
//
// Here we define a physical curve that groups the left, bottom and right curves
// in a single group (with prescribed tag 5); and a physical surface with name
// "My surface" (with an automatic tag) containing the geometrical surface 1:

Physical Curve(5) = {1, 2, 4};
Physical Surface("My surface") = {1};
```

**翻译**:
```
// 到这个阶段，Gmsh 已经知道如何显示矩形曲面 1 并对其进行网格划分。
// 如果我们想将基本几何实体分组为更有意义的组，则需要一个可选步骤，
// 例如定义一些数学性质（"域"、"边界"）、功能性质（"左机翼"、"机身"）
// 或材料性质（"钢"、"碳"）。
//
// 这样的组在 Gmsh 中称为"物理分组"。默认情况下，如果定义了物理分组，
// Gmsh 将仅在输出文件中导出属于至少一个物理分组的网格元素。
// （要强制 Gmsh 保存所有元素，无论它们是否属于物理分组，
// 请设置 `Mesh.SaveAll=1;`，或在命令行指定 `-save_all`。）
// 物理分组也由标签标识，即严格的正整数，每个维度（0D、1D、2D 或 3D）应唯一。
// 物理分组也可以被赋予名称。
//
// 这里我们定义一个物理曲线，将左边、底边和右边的曲线分组在一起
// （使用指定的标签 5）；以及一个名为 "My surface" 的物理曲面
// （使用自动标签），包含几何曲面 1：

Physical Curve(5) = {1, 2, 4};           // 将线1、2、4分组，标签为5
Physical Surface("My surface") = {1};    // 将面1分组，命名为"My surface"
```

**物理分组的用途**:

| 用途类型 | 示例 | 说明 |
|----------|------|------|
| 数学定义 | "domain", "boundary" | 定义求解域和边界条件区域 |
| 功能定义 | "left wing", "fuselage" | 按结构功能分组 |
| 材料定义 | "steel", "carbon" | 按材料属性分组 |

**两种定义方式**:
1. 使用数字标签: `Physical Curve(5) = {...};`
2. 使用字符串名称: `Physical Surface("My surface") = {...};`（自动分配标签）

**重要选项**:
- `Mesh.SaveAll = 1;`: 保存所有网格元素（不仅仅是物理分组中的）
- 命令行: `-save_all`

---

### 第 87-100 行：网格生成方法

```geo
// Now that the geometry is complete, you can
// - either open this file with Gmsh and select `2D' in the `Mesh' module to
//   create a mesh; then select `Save' to save it to disk in the default format
//   (or use `File->Export' to export in other formats);
// - or run `gmsh t1.geo -2` to mesh in batch mode on the command line.

// You could also uncomment the following lines in this script:
//
//   Mesh 2;
//   Save "t1.msh";
//
// which would lead Gmsh to mesh and save the mesh every time the file is
// parsed. (To simply parse the file from the command line, you can use `gmsh
// t1.geo -')
```

**翻译**:
```
// 现在几何模型已经完成，你可以：
// - 用 Gmsh 打开这个文件，在 `Mesh` 模块中选择 `2D` 来创建网格；
//   然后选择 `Save` 以默认格式保存到磁盘
//   （或使用 `File->Export` 导出为其他格式）；
// - 或在命令行运行 `gmsh t1.geo -2` 以批处理模式生成网格。

// 你也可以取消注释脚本中的以下几行：
//
//   Mesh 2;        // 生成2D网格
//   Save "t1.msh"; // 保存网格文件
//
// 这将使 Gmsh 每次解析文件时都生成并保存网格。
// （要仅从命令行解析文件，可以使用 `gmsh t1.geo -`）
```

**网格生成命令**:

| 命令 | 含义 |
|------|------|
| `Mesh 1;` | 生成 1D 网格（线网格） |
| `Mesh 2;` | 生成 2D 网格（面网格） |
| `Mesh 3;` | 生成 3D 网格（体网格） |

**命令行参数**:

| 参数 | 含义 |
|------|------|
| `-1` | 生成 1D 网格 |
| `-2` | 生成 2D 网格 |
| `-3` | 生成 3D 网格 |
| `-` | 仅解析文件，不生成网格 |

---

### 第 102-119 行：文件格式说明

```geo
// By default, Gmsh saves meshes in the latest version of the Gmsh mesh file
// format (the `MSH' format). You can save meshes in other mesh formats by
// specifying a filename with a different extension in the GUI, on the command
// line or in scripts. For example
//
//   Save "t1.unv";
//
// will save the mesh in the UNV format. You can also save the mesh in older
// versions of the MSH format:
//
// - In the GUI: open `File->Export', enter your `filename.msh' and then pick
//   the version in the dropdown menu.
// - On the command line: use the `-format' option (e.g. `gmsh file.geo -format
//   msh2 -2').
// - In a `.geo' script: add `Mesh.MshFileVersion = x.y;' for any version
//   number `x.y'.
// - As an alternative method, you can also not specify the format explicitly,
//   and just choose a filename with the `.msh2' or `.msh4' extension.
```

**翻译**:
```
// 默认情况下，Gmsh 以最新版本的 Gmsh 网格文件格式（`MSH` 格式）保存网格。
// 你可以通过在 GUI、命令行或脚本中指定具有不同扩展名的文件名
// 来以其他网格格式保存网格。例如：
//
//   Save "t1.unv";    // 以 UNV 格式保存
//
// 将以 UNV 格式保存网格。你也可以以旧版本的 MSH 格式保存网格：
//
// - 在 GUI 中：打开 `File->Export`，输入你的 `filename.msh`，
//   然后在下拉菜单中选择版本。
// - 在命令行：使用 `-format` 选项（例如 `gmsh file.geo -format msh2 -2`）。
// - 在 `.geo` 脚本中：添加 `Mesh.MshFileVersion = x.y;`（x.y 为任意版本号）。
// - 作为替代方法，你也可以不显式指定格式，
//   只需选择带有 `.msh2` 或 `.msh4` 扩展名的文件名。
```

**常见网格文件格式**:

| 格式 | 扩展名 | 说明 |
|------|--------|------|
| MSH | .msh | Gmsh 原生格式 |
| UNV | .unv | 通用格式（Salome 等软件支持） |
| VTK | .vtk | ParaView 可视化格式 |
| MED | .med | Salome/Code_Aster 格式 |
| CGNS | .cgns | CFD 通用标记系统 |

**MSH 版本控制**:
```geo
Mesh.MshFileVersion = 2.2;  // 使用 MSH 2.2 版本
Mesh.MshFileVersion = 4.1;  // 使用 MSH 4.1 版本
```

---

### 第 121-138 行：OpenCASCADE 几何内核

```geo
// Note that starting with Gmsh 3.0, models can be built using other geometry
// kernels than the default built-in kernel. By specifying
//
//   SetFactory("OpenCASCADE");
//
// any subsequent command in the `.geo' file would be handled by the OpenCASCADE
// geometry kernel instead of the built-in kernel. Different geometry kernels
// have different features. With OpenCASCADE, instead of defining the surface by
// successively defining 4 points, 4 curves and 1 curve loop, one can define the
// rectangular surface directly with
//
//   Rectangle(2) = {.2, 0, 0, .1, .3};
//
// The underlying curves and points could be accessed with the `Boundary' or
// `CombinedBoundary' operators.
//
// See e.g. `t16.geo', `t18.geo', `t19.geo' or `t20.geo' for complete examples
// based on OpenCASCADE, and `examples/boolean' for more.
```

**翻译**:
```
// 注意，从 Gmsh 3.0 开始，模型可以使用默认内置内核之外的其他几何内核来构建。
// 通过指定：
//
//   SetFactory("OpenCASCADE");
//
// `.geo` 文件中的任何后续命令将由 OpenCASCADE 几何内核而不是内置内核处理。
// 不同的几何内核有不同的功能。使用 OpenCASCADE，我们可以直接定义矩形曲面，
// 而不是依次定义 4 个点、4 条曲线和 1 个曲线环：
//
//   Rectangle(2) = {.2, 0, 0, .1, .3};   // 起点(0.2,0,0)，宽0.1，高0.3
//
// 底层的曲线和点可以通过 `Boundary` 或 `CombinedBoundary` 操作符访问。
//
// 参见 `t16.geo`、`t18.geo`、`t19.geo` 或 `t20.geo` 了解基于 OpenCASCADE 的
// 完整示例，以及 `examples/boolean` 了解更多。
```

**两种几何内核对比**:

| 特性 | 内置内核 | OpenCASCADE |
|------|----------|-------------|
| 基本实体 | 需手动定义点、线、面 | 支持高级几何原语 |
| 布尔运算 | 有限支持 | 完整支持（交、并、差） |
| CAD 导入 | 有限 | 完整支持 STEP/IGES |
| 速度 | 较快 | 较慢 |
| 复杂度 | 简单几何 | 复杂 CAD 模型 |

**OpenCASCADE 高级原语示例**:
```geo
SetFactory("OpenCASCADE");

// 矩形: Rectangle(tag) = {x, y, z, width, height};
Rectangle(1) = {0, 0, 0, 1, 0.5};

// 圆盘: Disk(tag) = {x, y, z, radius};
Disk(2) = {0.5, 0.25, 0, 0.2};

// 长方体: Box(tag) = {x, y, z, dx, dy, dz};
Box(3) = {0, 0, 0, 1, 1, 1};

// 球体: Sphere(tag) = {x, y, z, radius};
Sphere(4) = {0, 0, 0, 0.5};

// 圆柱: Cylinder(tag) = {x, y, z, dx, dy, dz, radius};
Cylinder(5) = {0, 0, 0, 0, 0, 1, 0.3};
```

---

## 完整代码（带中文注释）

```geo
// -----------------------------------------------------------------------------
//  Gmsh GEO 教程 1
//  几何基础、基本实体、物理分组
// -----------------------------------------------------------------------------

// 定义特征长度（网格尺寸控制参数）
lc = 1e-2;  // 0.01，控制网格元素的大小

// ============ 第一步：定义点 ============
// 语法: Point(标签) = {X坐标, Y坐标, Z坐标, 网格尺寸};

Point(1) = {0, 0, 0, lc};     // 左下角原点
Point(2) = {.1, 0, 0, lc};    // 右下角 (0.1, 0, 0)
Point(3) = {.1, .3, 0, lc};   // 右上角 (0.1, 0.3, 0)
Point(4) = {0, .3, 0, lc};    // 左上角 (0, 0.3, 0)

// ============ 第二步：定义线 ============
// 语法: Line(标签) = {起点, 终点};

Line(1) = {1, 2};   // 底边: 点1 → 点2
Line(2) = {3, 2};   // 右边: 点3 → 点2 (向下方向)
Line(3) = {3, 4};   // 顶边: 点3 → 点4
Line(4) = {4, 1};   // 左边: 点4 → 点1

// ============ 第三步：定义曲线环 ============
// 语法: Curve Loop(标签) = {线1, 线2, ...};
// 正数表示原方向，负数表示反方向

Curve Loop(1) = {4, 1, -2, 3};
// 解释:
//   线4: 4→1 (原方向)
//   线1: 1→2 (原方向)
//   线-2: 2→3 (反方向，原为3→2)
//   线3: 3→4 (原方向)
// 形成闭合环: 4→1→2→3→4

// ============ 第四步：定义平面 ============
// 语法: Plane Surface(标签) = {曲线环1, 曲线环2, ...};
// 多个曲线环时，第一个是外边界，其余是孔洞

Plane Surface(1) = {1};   // 使用曲线环1作为边界

// ============ 第五步：定义物理分组（可选） ============
// 用于将几何实体组织成有意义的组，便于施加边界条件和材料属性

Physical Curve(5) = {1, 2, 4};           // 将线1、2、4分组，标签为5
Physical Surface("My surface") = {1};    // 将面1命名为"My surface"

// ============ 生成网格（可选） ============
// 取消下面两行注释以自动生成并保存网格

// Mesh 2;           // 生成2D网格
// Save "t1.msh";    // 保存为MSH格式
```

---

## 实践练习

### 练习1：修改矩形尺寸
尝试将矩形的宽度改为 0.2，高度改为 0.5。

### 练习2：添加孔洞
在矩形中心添加一个小矩形孔洞。提示：需要定义额外的点、线、曲线环，然后修改 Plane Surface 命令。

### 练习3：使用 OpenCASCADE
使用 `SetFactory("OpenCASCADE");` 和 `Rectangle` 命令重写这个几何模型。

### 练习4：生成不同格式的网格
尝试生成网格并保存为不同格式（.msh, .unv, .vtk）。

---

## 命令速查表

| 命令 | 语法 | 示例 |
|------|------|------|
| Point | `Point(tag) = {x, y, z, lc};` | `Point(1) = {0, 0, 0, 0.1};` |
| Line | `Line(tag) = {start, end};` | `Line(1) = {1, 2};` |
| Curve Loop | `Curve Loop(tag) = {c1, c2, ...};` | `Curve Loop(1) = {1, 2, -3, 4};` |
| Plane Surface | `Plane Surface(tag) = {loop1, ...};` | `Plane Surface(1) = {1};` |
| Physical Curve | `Physical Curve(tag) = {c1, c2, ...};` | `Physical Curve(1) = {1, 2};` |
| Physical Surface | `Physical Surface(name) = {s1, ...};` | `Physical Surface("domain") = {1};` |

---

## 相关教程

- **t4.geo**: 带孔洞的曲面
- **t7.geo**: 背景网格
- **t10.geo**: 网格尺寸场
- **t16.geo**: OpenCASCADE 入门
- **t18-t20.geo**: OpenCASCADE 高级应用

---

*学习笔记完成日期: Day 2*
