# 计算几何中的数据结构

## 概述

在计算几何中，选择合适的数据结构对算法效率至关重要。本文档介绍三种核心内容：
1. 基本数据结构的时间复杂度比较
2. AVL 平衡二叉树
3. 翼边结构（Winged-Edge Data Structure）

## 1. 基本数据结构时间复杂度比较

设有 n 个元素被放在数据结构中，各种数据结构的操作时间复杂度如下：

### 1.1 数组（Array）

| 操作 | 时间复杂度 | 条件 |
|------|-----------|------|
| 插入 | O(n) | 需要移动元素 |
| 删除 | O(n) | 需要移动元素 |
| 搜索（无序） | O(n) | 线性搜索 |
| 搜索（有序） | O(log n) | 二分查找 |

**特点**：
- 连续内存存储，支持随机访问 O(1)
- 单调序列可使用二分法快速搜索
- 插入删除代价高，需移动大量元素

### 1.2 双向链表（Doubly Linked List）

| 操作 | 时间复杂度 | 条件 |
|------|-----------|------|
| 插入 | O(1) | 已知位置 |
| 删除 | O(1) | 已知位置 |
| 插入 | O(n) | 未知位置，需先搜索 |
| 删除 | O(n) | 未知位置，需先搜索 |
| 搜索 | O(n) | 必须顺序遍历 |

**特点**：
- 非连续存储，通过指针链接
- 在已知位置插入删除非常高效
- 不支持随机访问，搜索效率低

### 1.3 平衡二叉树

| 操作 | 时间复杂度 |
|------|-----------|
| 插入 | O(log n) |
| 删除 | O(log n) |
| 搜索 | O(log n) |

**特点**：
- 元素按序存放，保持树的平衡
- 所有操作都是 O(log n)，综合性能最佳
- 适合需要频繁插入、删除、搜索的场景

### 1.4 选择原则

不同的数据结构有不同的特点，在算法中**必须根据问题本身的情况及数据结构不同的特点来选用数据结构**。

| 场景 | 推荐数据结构 |
|------|-------------|
| 静态数据，频繁搜索 | 有序数组 + 二分查找 |
| 频繁在已知位置插入删除 | 双向链表 |
| 动态数据，各种操作都频繁 | 平衡二叉树 |

## 2. AVL 树（AVL Tree）

### 2.1 定义

AVL 树是一种**平衡二叉树**，由 Adelson-Velsky 和 Landis 在 1962 年提出，是计算机科学中最早发明的自平衡二叉搜索树。

**定义 1.1**：设 T 是一非空的二叉树，v 是 T 的任一结点，vT_L 和 vT_R 分别是它的左子树和右子树。如果 vT_L 和 vT_R 都是二叉树，且 |h_L - h_R| ≤ 1，其中 h_L 和 h_R 分别是 vT_L 和 vT_R 的高度，则称 T 为一棵 **AVL 树**。

**关键约束**：任意节点的左右子树高度差的绝对值不超过 1。

```
平衡因子 = h_L - h_R ∈ {-1, 0, 1}
```

**特殊情况**：空树也认为是一棵 AVL 树。

### 2.2 核心性质

1. **平衡性**：在嵌入或删除一个结点时，在树的每个结点处必须保持它的左右子树平衡

2. **时间复杂度**：
   - 平衡工作（旋转操作）可在 O(log n) 时间内完成
   - 嵌入操作：O(log n)
   - 删除操作：O(log n)
   - 搜索操作：O(log n)

### 2.3 平衡操作（旋转）

当插入或删除导致不平衡时，需要通过旋转操作恢复平衡：

**四种旋转类型**：

```
1. 左旋（Left Rotation）- RR 型

       A                    B
        \                  / \
         B       =>       A   C
          \
           C

2. 右旋（Right Rotation）- LL 型

         C                  B
        /                  / \
       B         =>       A   C
      /
     A

3. 左右旋（Left-Right Rotation）- LR 型

       C                  C                  B
      /                  /                  / \
     A         =>       B        =>       A   C
      \                /
       B              A

4. 右左旋（Right-Left Rotation）- RL 型

     A                  A                    B
      \                  \                  / \
       C       =>         B      =>       A   C
      /                    \
     B                      C
```

### 2.4 AVL 树的高度

对于包含 n 个节点的 AVL 树，其高度 h 满足：

```
h < 1.44 * log₂(n + 2) - 0.328
```

即高度约为 O(log n)，这保证了所有操作的对数时间复杂度。

### 2.5 在计算几何中的应用

AVL 树在计算几何算法中常用于：
- **事件队列**：按 x 或 y 坐标排序的事件点
- **状态结构**：扫描线算法中维护当前状态
- **区间树**：存储线段，支持快速查询相交
- **范围搜索**：在给定范围内快速找到所有点

## 3. 翼边结构（Winged-Edge Data Structure）

### 3.1 背景

在计算几何中常讨论**平面的分割**和**多面体的操作**。这时不仅要保存其中的点、线及区域，还要保存**边和相邻的边和区域的关系**。只有这样才会提高对几何对象操作的效率和降低算法的时间复杂度。

翼边结构是**立体造型**中常用的**边界表示法**（B-Rep, Boundary Representation）中的一种数据结构。

### 3.2 设计思想

翼边结构以**边为中心**组织结构，同时对点和面用单独的结构保持它们的一些几何特征。

**核心理念**：
- 在数据结构中保存冗余信息，可提高算法效率
- 但信息保存多了会造成空间复杂度的提高
- 好的数据结构应考虑**时间复杂度和空间复杂度两个方面的协调**

### 3.3 结构定义

对于每一条边 e = p₁p₂，翼边结构存储以下信息：

```
WingedEdge {
    // 顶点信息
    Vertex* p1;      // 边的起点
    Vertex* p2;      // 边的终点

    // 相邻面信息
    Face* f_left;    // 左侧面 (f_l)
    Face* f_right;   // 右侧面 (f_r)

    // 相邻边信息（四条"翼"）
    Edge* e_lcw;     // 左侧顺时针方向的边
    Edge* e_lcc;     // 左侧逆时针方向的边（left counter-clockwise）
    Edge* e_rcw;     // 右侧顺时针方向的边
    Edge* e_rcc;     // 右侧逆时针方向的边（right counter-clockwise）
}
```

### 3.4 结构图示

```
                e_lcc
                  ↑
            p2 ●──────●
              /│      │\
             / │      │ \
     e_rcw  /  │  e   │  \  e_lcw
           /   │      │   \
          /    │      │    \
         ● f_r │      │ f_l ●
          \    │      │    /
           \   │      │   /
     e_rcc  \  │      │  /  (其他边)
             \ │      │ /
              \│      │/
            p1 ●──────●
                  ↓
               (其他边)

图示说明：
- e: 当前边，连接 p1 和 p2
- f_l: 边 e 的左侧面
- f_r: 边 e 的右侧面
- e_lcw: 从 p1 出发，沿 f_l 顺时针方向的下一条边
- e_lcc: 从 p2 出发，沿 f_l 逆时针方向的下一条边
- e_rcw: 从 p2 出发，沿 f_r 顺时针方向的下一条边
- e_rcc: 从 p1 出发，沿 f_r 逆时针方向的下一条边
```

### 3.5 命名规则

边的命名遵循以下规则（从 p1 到 p2 的方向看）：

| 缩写 | 全称 | 含义 |
|------|------|------|
| l | left | 左侧 |
| r | right | 右侧 |
| cw | clockwise | 顺时针 |
| cc/ccw | counter-clockwise | 逆时针 |

所以：
- **e_lcc**: left counter-clockwise，左侧逆时针边
- **e_lcw**: left clockwise，左侧顺时针边
- **e_rcc**: right counter-clockwise，右侧逆时针边
- **e_rcw**: right clockwise，右侧顺时针边

### 3.6 核心操作

有了翼边结构中的联系，可以高效地完成以下几何操作：

**1. 遍历面的所有边（O(k)，k 为边数）**

```cpp
// 遍历面 f 的所有边
Edge* start = f->oneEdge;
Edge* current = start;
do {
    process(current);
    current = nextEdgeAroundFace(current, f);
} while (current != start);
```

**2. 遍历顶点的所有边（O(k)，k 为相邻边数）**

```cpp
// 遍历顶点 v 的所有边
Edge* start = v->oneEdge;
Edge* current = start;
do {
    process(current);
    current = nextEdgeAroundVertex(current, v);
} while (current != start);
```

**3. 查找相邻面（O(1)）**

```cpp
Face* getLeftFace(Edge* e) { return e->f_left; }
Face* getRightFace(Edge* e) { return e->f_right; }
```

**4. 欧拉操作（拓扑修改）**

翼边结构支持欧拉操作，如：
- MEV（Make Edge Vertex）：创建边和顶点
- MEF（Make Edge Face）：创建边和面
- KEV（Kill Edge Vertex）：删除边和顶点
- KEF（Kill Edge Face）：删除边和面

### 3.7 空间复杂度

| 数据 | 存储量 |
|------|--------|
| 每条边 | 8 个指针（2 顶点 + 2 面 + 4 相邻边） |
| 每个顶点 | 坐标 + 1 个指针（指向一条相邻边） |
| 每个面 | 属性 + 1 个指针（指向一条边界边） |

对于多面体，满足欧拉公式：**V - E + F = 2**

### 3.8 优缺点

**优点**：
- 所有邻接信息都可 O(1) 时间获取
- 遍历操作高效
- 支持复杂的拓扑操作

**缺点**：
- 存储空间较大（每条边需 8 个指针）
- 更新操作复杂（需维护多个指针）
- 仅适用于流形（manifold）表面

### 3.9 变体和替代方案

| 数据结构 | 特点 |
|----------|------|
| **半边结构（Half-Edge）** | 每条边拆成两条有向半边，更简洁 |
| **四边结构（Quad-Edge）** | 同时表示原图和对偶图，用于 Voronoi 图 |
| **面边结构（Face-Edge）** | 以面为中心组织 |

### 3.10 在 Gmsh 中的应用

Gmsh 的几何模块（`src/geo/`）中使用类似的边界表示：

- `GVertex`：顶点实体
- `GEdge`：边实体，存储起点和终点的引用
- `GFace`：面实体，存储边界边的列表
- `GRegion`：体实体，存储边界面的列表

这些实体通过指针相互关联，实现了类似翼边结构的邻接信息访问。

## 4. 总结

### 4.1 数据结构选择指南

| 应用场景 | 推荐数据结构 | 原因 |
|----------|-------------|------|
| 静态几何查询 | 有序数组 | 二分查找 O(log n) |
| 动态点集维护 | AVL 树 / 红黑树 | 均衡的增删查性能 |
| 扫描线算法 | 平衡二叉树 | 动态维护状态 |
| 多面体表示 | 翼边/半边结构 | 高效邻接查询 |
| 平面细分 | 四边结构 | 同时处理原图和对偶 |

### 4.2 核心原则

1. **根据问题特点选择数据结构**：没有万能的数据结构

2. **权衡时间与空间**：冗余信息提高速度但增加存储

3. **考虑操作频率**：针对最频繁的操作优化

4. **保持一致性**：复杂数据结构需要仔细维护指针关系

## 参考资料

1. 周培德. 计算几何——算法设计与分析（第4版）
2. de Berg et al. Computational Geometry: Algorithms and Applications
3. Baumgart, B. G. "Winged Edge Polyhedron Representation." (1972)
4. Gmsh 源码: `src/geo/` 目录
